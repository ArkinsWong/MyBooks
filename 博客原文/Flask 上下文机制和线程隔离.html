<!DOCTYPE html>
<!-- saved from url=(0045)https://www.cnblogs.com/panlq/p/13266426.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="origin-when-crossorigin">
    <meta name="description" content="1. 计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决， 上下文机制就是这句话的体现。 2. 如果一次封装解决不了问题，那就再来一次 上下文：相当于一个容器，保存了Flask程序运行过程中">
    <meta property="og:description" content="1. 计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决， 上下文机制就是这句话的体现。 2. 如果一次封装解决不了问题，那就再来一次 上下文：相当于一个容器，保存了Flask程序运行过程中">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Flask 上下文机制和线程隔离 - JonPan - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="https://common.cnblogs.com/favicon.svg" type="image/svg+xml">
    
    <link rel="stylesheet" href="./Flask 上下文机制和线程隔离_files/blog-common.min.css">
    <link id="MainCss" rel="stylesheet" href="./Flask 上下文机制和线程隔离_files/bundle-custom.min.css">
    <link type="text/css" rel="stylesheet" href="./Flask 上下文机制和线程隔离_files/custom.css">
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./Flask 上下文机制和线程隔离_files/bundle-custom-mobile.min.css">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/panlq/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/panlq/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/panlq/wlwmanifest.xml">
    <script src="./Flask 上下文机制和线程隔离_files/osd.js.下载"></script><script async="" src="./Flask 上下文机制和线程隔离_files/analytics.js.下载"></script><script>
        var currentBlogId = 416394;
        var currentBlogApp = 'panlq';
        var cb_enable_mathjax = true;
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'Custom';
        var visitorUserId = '';
    </script>
        <script>
            var currentPostDateAdded = '2020-07-08 01:35';
        </script>
    <script src="./Flask 上下文机制和线程隔离_files/jquery-2.2.0.min.js.下载"></script>
    <script src="./Flask 上下文机制和线程隔离_files/blog-common.min.js.下载"></script><style type="text/css">.medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}</style>
    <script type="text/x-mathjax-config;executed=true">
        MathJax.Hub.Config({
        tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processClass: 'math', processEscapes: true },
        TeX: {
        equationNumbers: { autoNumber: ['AMS'], useLabelIds: true },
        extensions: ['extpfeil.js', 'mediawiki-texvc.js'],
        Macros: {bm: "\\boldsymbol"}
        },
        'HTML-CSS': { linebreaks: { automatic: true } },
        SVG: { linebreaks: { automatic: true } }
        });
    </script>
    <script src="./Flask 上下文机制和线程隔离_files/MathJax.js.下载"></script>
    
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover, .MJXp-munder {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > *, .MJXp-munder > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><meta http-equiv="origin-trial" content="A+b/H0b8RPXNaJgaNFpO0YOFuGK6myDQXlwnJB3SwzvNMfcndat4DZYMrP4ClJIzYWo3/yP2S+8FTZ/lpqbPAAEAAABueyJvcmlnaW4iOiJodHRwczovL2ltYXNkay5nb29nbGVhcGlzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2MjYyMjA3OTksImlzVGhpcmRQYXJ0eSI6dHJ1ZX0="><meta http-equiv="origin-trial" content="A9ZgbRtm4pU3oZiuNzOsKcC8ppFSZdcjP2qYcdQrFKVzkmiWH1kdYY1Mi9x7G8+PS8HV9Ha9Cz0gaMdKsiVZIgMAAAB7eyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2MjYyMjA3OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="AxL6oBxcpn5rQDPKSAs+d0oxNyJYq2/4esBUh3Yx5z8QfcLu+AU8iFCXYRcr/CEEfDnkxxLTsvXPJFQBxHfvkgMAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2MjYyMjA3OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="A9KPtG5kl3oLTk21xqynDPGQ5t18bSOpwt0w6kGa6dEWbuwjpffmdUpR3W+faZDubGT+KIk2do0BX2ca16x8qAcAAACBeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiVHJ1c3RUb2tlbnMiLCJleHBpcnkiOjE2MjYyMjA3OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="A3HucHUo1oW9s+9kIKz8mLkbcmdaj5lxt3eiIMp1Nh49dkkBlg1Fhg4Fd/r0vL69mRRA36YutI9P/lJUfL8csQoAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjI2MjIwNzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A0OysezhLoCRYomumeYlubLurZTCmsjTb087OvtCy95jNM65cfEsbajrJnhaGwiTxhz38ZZbm+UhUwQuXfVPTg0AAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjI2MjIwNzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="AxoOxdZQmIoA1WeAPDixRAeWDdgs7ZtVFfH2y19ziTgD1iaHE5ZGz2UdSjubkWvob9C5PrjUfkWi4ZSLgWk3Xg8AAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjI2MjIwNzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A7+rMYR5onPnACrz+niKSeFdH3xw1IyHo2AZSHmxrofRk9w4HcQPMYcpBUKu6OQ6zsdxf4m/vqa6tG6Na4OLpAQAAAB4eyJvcmlnaW4iOiJodHRwczovL2ltYXNkay5nb29nbGVhcGlzLmNvbTo0NDMiLCJmZWF0dXJlIjoiQ29udmVyc2lvbk1lYXN1cmVtZW50IiwiZXhwaXJ5IjoxNjI2MjIwNzk5LCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="AwfG8hAcHnPa/kJ1Co0EvG/K0F9l1s2JZGiDLt2mhC3QI5Fh4qmsmSwrWObZFbRC9ieDaSLU6lHRxhGUF/i9sgoAAACBeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiSW50ZXJlc3RDb2hvcnRBUEkiLCJleHBpcnkiOjE2MjYyMjA3OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="AwQ7dCmHkvR6FuOFxAuNnktYSQrGbL4dF+eBkrwNLALc69Wr//PnO1yzns3pjUoCaYbKHtVcnng2hU+8OUm0PAYAAACHeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiSW50ZXJlc3RDb2hvcnRBUEkiLCJleHBpcnkiOjE2MjYyMjA3OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><meta http-equiv="origin-trial" content="AysVDPGQTLD/Scn78x4mLwB1tMfje5jwUpAAzGRpWsr1NzoN7MTFhT3ClmImi2svDZA7V6nWGIV8YTPsSRTe0wYAAACHeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiSW50ZXJlc3RDb2hvcnRBUEkiLCJleHBpcnkiOjE2MjYyMjA3OTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"><script src="./Flask 上下文机制和线程隔离_files/pubads_impl_2021060301.js.下载" async=""></script><link rel="preload" href="./Flask 上下文机制和线程隔离_files/f.txt" as="script"><script type="text/javascript" src="./Flask 上下文机制和线程隔离_files/f.txt"></script><link rel="prefetch" href="https://481f7d0218e9da4556fb677d8c921dad.safeframe.googlesyndication.com/safeframe/1-0-38/html/container.html"><link rel="shortcut icon" href="https://images.cnblogs.com/cnblogs_com/panlq/1629174/o_200119145814favicon.png" type="image/x-icon"><link rel="stylesheet" href="./Flask 上下文机制和线程隔离_files/lightbox.min.css"></head>
<body class="no-navbar"><div class="esa-mobile-menu"></div><div id="MathJax_Message" style="display: none;"></div>
    <a name="top"></a>
        <div id="bannerbar" class="bannerbar-mobile formobile">
            <a href="https://www.aliyun.com/minisite/goods?userCode=swh7dvlt" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;aliyun-cps-blog-bannerbar-mobile&#39;)">
                <img src="./Flask 上下文机制和线程隔离_files/35695-20210428213541700-642740375.jpg" alt="">
            </a>
        </div>
    <div id="top_nav" class="navbar forpc navbar-custom">
        <nav id="nav_main" class="navbar-main">
            <ul id="nav_left" class="navbar-list navbar-left">
                <li class="navbar-branding"><a href="https://www.cnblogs.com/" title="开发者的网上家园"><img src="./Flask 上下文机制和线程隔离_files/logo.svg" alt="博客园Logo"></a></li>
                <li><a href="https://www.cnblogs.com/" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;skin-navbar-sitehome&#39;)">首页</a></li>
                <li><a href="https://news.cnblogs.com/" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;skin-navbar-news&#39;)">新闻</a></li>
                <li><a href="https://q.cnblogs.com/" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;skin-navbar-q&#39;)">博问</a></li>
                <li><a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;skin-navbar-brands&#39;)">专区</a></li>
                <li><a href="https://ing.cnblogs.com/" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;skin-navbar-ing&#39;)">闪存</a></li>
                <li><a href="https://edu.cnblogs.com/" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;skin-navbar-edu&#39;)">班级</a></li>
            </ul>
            <ul id="nav_right" class="navbar-list navbar-right">
                <li>
                    <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get">
                        <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="text" tabindex="3">
                        <button type="submit" id="zzk_search_button">
                            <img src="./Flask 上下文机制和线程隔离_files/search.svg" alt="搜索">
                        </button>
                    </form>
                </li>
                <li id="navbar_login_status" class="navbar-list">
                    <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔" style="display: none;">
                        <img id="new_post_icon" class="navbar-icon" src="./Flask 上下文机制和线程隔离_files/newpost.svg" alt="写随笔">
                    </a>
                    <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客" style="display: none;">
                        <img id="myblog_icon" class="navbar-icon" src="./Flask 上下文机制和线程隔离_files/myblog.svg" alt="我的博客">
                    </a>
                    <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息" style="display: none;">
                        <img id="msg_icon" class="navbar-icon" src="./Flask 上下文机制和线程隔离_files/message.svg" alt="短消息">
                        <span id="msg_count" style="display: none"></span>
                    </a>
                    <div id="user_info" class="navbar-user-info dropdown" style="display: none;">
                        <a class="dropdown-button" href="https://home.cnblogs.com/">
                            <img id="user_icon" class="navbar-avatar" src="./Flask 上下文机制和线程隔离_files/avatar-default.svg" alt="用户头像">
                        </a>
                        <div class="dropdown-menu">
                            <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                            <a href="https://home.cnblogs.com/">我的园子</a>
                            <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                            <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <img id="navbar_lite_mode_on" src="./Flask 上下文机制和线程隔离_files/lite-mode-check.svg" class="hide"><span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>
                            <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                        </div>
                    </div>
                    <a class="navbar-anonymous" href="https://account.cnblogs.com/signup/" style="display: inline;">注册</a>
                    <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()" style="display: inline;">登录</a>
                </li>
            </ul>
        </nav>
    </div>

    <div id="page_begin_html">
        


    </div>
    <!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/panlq/"><img id="blogLogo" src="./Flask 上下文机制和线程隔离_files/logo.gif" alt="返回主页"></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/panlq/">JonPan</a>
</h1>
<h2></h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
<i></i></li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/panlq/">
首页</a>
<i></i></li><li><a class="menu" href="https://www.cnblogs.com/panlq/tag/">标签</a><i></i></li><li><a class="menu" href="https://www.cnblogs.com/panlq/p/">归档</a><i></i></li><li><a class="menu" href="https://www.cnblogs.com/panlq/category/1486847.html">每日一题</a><i></i></li>
                            <li class="esa-has-subnavs">
                                <a class="menu" href="javascript:void(0);">导航
                                    <svg class="arrow" width="12px" height="8px" viewBox="0 0 14 8" xml:space="preserve" fill="none" stroke="rgb(49, 70, 89)"><path d="M1,1l6.2,6L13,1"></path></svg>
                                </a>
                                <ul class="esa-sub-navs"><li><a class="menu" href="http://hwyx.91sq.cc/" target="_blank">好物优选</a></li></ul>
                            <i></i></li>
<li>


<i></i></li>
<li>
<i></i></li>
<li>

<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--><i></i></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
<i></i></li>
</ul>


		<div class="blogStats">
			<span id="stats_post_count">随笔 - 33&nbsp; </span>
<span id="stats_article_count">文章 - 20&nbsp; </span>
<span id="stats-comment_count">评论 - 20&nbsp; </span>
<span id="stats-total-view-count">阅读 - 
<span title="总阅读数: 178564">
17万</span></span>

		</div><!--end: blogStats -->
	
                <svg t="1573264861612" class="icon esa-search-btn" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7386" width="32" height="32" data-spm-anchor-id="a313x.7781069.0.i8">
                    <path fill="rgb(49, 70, 89)" d="M616.362667 580.608h-23.808l-8.533334-8.128a196.16 196.16 0 1 0-21.098666 21.098667l8.128 8.533333v23.808l150.805333 150.165333 44.8-44.8z m-180.8 0a135.594667 135.594667 0 1 1 135.594666-135.594667 135.402667 135.402667 0 0 1-135.573333 135.594667z" p-id="7387"></path>
                </svg>
                <svg t="1573265135257" class="icon esa-search-close" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15367" width="32" height="32">
                    <path fill="rgb(49, 70, 89)" d="M515.23600182 491.06853843L378.27564815 354.10818478a17.09155825 17.09155825 0 1 0-24.17885764 24.15606913l136.96035332 136.97174792-136.96035331 136.97174789a17.09155825 17.09155825 0 1 0 24.16746339 24.16746337l136.97174791-136.96035366 136.9717479 136.96035366a17.09155825 17.09155825 0 1 0 24.16746337-24.15606912l-136.96035366-136.98314215 136.96035366-136.96035367a17.09155825 17.09155825 0 1 0-24.16746337-24.16746337l-136.96035366 136.96035364z" p-id="15368"></path>
                </svg></div><!--end: navigator 博客导航栏 -->

                <div class="esa-search-box">
                    <div class="div_my_zzk">
                        <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk" placeholder="Type to Search">&nbsp;<input onclick="zzk_go()" type="button" value="搜 索" id="btnZzk" class="btn_my_zzk">
                    </div>
                </div></div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/panlq/p/13266426.html">
    <span>Flask 上下文机制和线程隔离</span>
    



</a>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown">
<blockquote>
<p><strong>1. 计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决</strong>， 上下文机制就是这句话的体现。</p>
<p><strong>2. 如果一次封装解决不了问题，那就再来一次</strong></p>
</blockquote>
<p>上下文：相当于一个容器，保存了Flask程序运行过程中的一些信息 源码：<a href="https://github.com/pallets/flask/blob/master/src/flask/ctx.py" target="_blank">flask/ctx.py</a></p>
<ul>
<li>
<p>请求上下文：Flask从客户端收到请求时，要让视图函数能访问一些对象，这样才能处理请求，要想让视图函数能够访问请求对象，一个显而易见的方式是将其作为参数传入视图函数，不过这会导致程序中的每个视图函数都增加一个参数，除了访问请求对象,如果视图函数在处理请求时还要访问其他对象，情况会变得更糟。为了避免大量可有可无的参数把视图函数弄得一团糟，Flask使用上下文临时把某些对象变为全局可访问。<strong>这就是一种重构设计思路</strong>。</p>
<ul>
<li><strong>request</strong> 封装了HTTP请求的内容，针对http请求，也是一种符合WSGI接口规范的设计（<strong>关于WSGI可参考我对该协议的理解和实现demo <a href="https://github.com/Panlq/Py-Project/tree/master/mini-web" target="_blank">mini-wsgi-web</a></strong>），如 <code>request.args.get('user')</code></li>
<li><strong>session</strong> 用来记录请求会话中的信息，针对的是用户信息，如 <code>session['name'] = user.id</code></li>
</ul>
</li>
<li>
<p>应用上下文：应用程序上下文,用于存储应用程序中的变量</p>
<ul>
<li><strong>current_app</strong> 存储应用配置，数据库连接等应用相关信息</li>
<li><strong>g变量</strong> 作为flask程序全局的一个<strong>临时变量</strong>, 充当者中间媒介的作用,我们可以通过它传递一些数据，g保存的是当前请求的全局变量，<strong>不同的请求会有不同的全局变量，通过不同的thread id区别</strong></li>
</ul>
</li>
</ul>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_0">Copy</div><code class="language-python hljs" id="copy_target_0"><span class="hljs-comment"># context locals</span>
<span class="hljs-comment"># 使用代理模式 LocalProxy</span>
_request_ctx_stack = LocalStack()
_app_ctx_stack = LocalStack()
current_app = LocalProxy(_find_app)
request = LocalProxy(partial(_lookup_req_object, <span class="hljs-string">'request'</span>))
session = LocalProxy(partial(_lookup_req_object, <span class="hljs-string">'session'</span>))
g = LocalProxy(partial(_lookup_app_object, <span class="hljs-string">'g'</span>))
</code></pre>
<h2 id="3113764099">1. working outside application context<a href="https://www.cnblogs.com/panlq/p/13266426.html#3113764099" class="esa-anchor">#</a></h2>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_1">Copy</div><code class="language-python hljs" id="copy_target_1"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-comment"># __author__ = '__JonPan__'</span>

<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, current_app

app = Flask(__name__)
a = current_app
<span class="hljs-comment"># is_debug = current_app.config['DEBUG']</span>

<span class="hljs-meta">@app.route('/')</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;h1&gt;Hello World. Have a nice day! &lt;/1&gt;'</span>


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">8888</span>)
</code></pre>
<blockquote>
<p>报错:</p>
<p>Exception has occurred: RuntimeError</p>
<p>Working outside of application context.</p>
</blockquote>
<p><a href="./Flask 上下文机制和线程隔离_files/778496-20200708133619522-1637712399.png" data-title="" data-alt="" data-lightbox="roadtrip"><img src="./Flask 上下文机制和线程隔离_files/778496-20200708133619522-1637712399.png" alt="" loading="lazy"></a></p>
<h2 id="3459765618">2. flask 上下文出入栈<a href="https://www.cnblogs.com/panlq/p/13266426.html#3459765618" class="esa-anchor">#</a></h2>
<p><strong>flask上下文对象出入栈模型图</strong></p>
<p><a href="./Flask 上下文机制和线程隔离_files/778496-20200708154936922-1740856449.png" data-title="" data-alt="" data-lightbox="roadtrip"><img src="./Flask 上下文机制和线程隔离_files/778496-20200708154936922-1740856449.png" alt="" loading="lazy" class="medium-zoom-image"></a></p>
<p><strong>在应用开发中可用直接引用<code>current_app</code>不会报错，是因为当在一个请求中使用的时候，flask会判断<code>_app_ctx_stack</code>栈顶是否有可用对象，如果没有就会自动推入一个App</strong>. 我们获取的<code>current_app</code>就是获取的栈顶元素</p>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_2">Copy</div><code class="language-python hljs" id="copy_target_2"><span class="hljs-comment"># flask/globals.py</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_find_app</span>():</span>
    top = _app_ctx_stack.top
    <span class="hljs-keyword">if</span> top <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
        <span class="hljs-keyword">raise</span> RuntimeError(_app_ctx_err_msg)
    <span class="hljs-keyword">return</span> top.app

current_app = LocalProxy(_find_app)
</code></pre>
<p>修改代码：将app对象推入栈顶</p>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_3">Copy</div><code class="language-python hljs" id="copy_target_3"><span class="hljs-comment"># ...</span>
<span class="hljs-comment"># 将app_context 推入栈中</span>
ctx = app.app_context()
ctx.push()
a = current_app

is_debug = current_app.config[<span class="hljs-string">'DEBUG'</span>]
ctx.pop()
<span class="hljs-comment"># ...</span>

<span class="hljs-comment"># 更有pythonnic的写法</span>
<span class="hljs-comment"># 将app_context 推入栈中</span>
<span class="hljs-comment"># with app.app_context():</span>
<span class="hljs-comment">#     a = current_app</span>
<span class="hljs-comment">#     is_debug = current_app.config['DEBUG']</span>
</code></pre>
<p><a href="./Flask 上下文机制和线程隔离_files/778496-20200708155134961-419020986.png" data-title="" data-alt="" data-lightbox="roadtrip"><img src="./Flask 上下文机制和线程隔离_files/778496-20200708155134961-419020986.png" alt="" loading="lazy"></a></p>
<p>不在出现<code>unbound</code>状态。可正常运行</p>
<p>既然flask会自动帮我们检测栈顶元素是否存在，为什么我们还要做这一步操作，<strong>当我们在写离线应用，或者单元测试的时候就需要用到，因为请求是模拟的，不是在application context中的了。</strong></p>
<h2 id="322225399">3. python中的上文管理器<a href="https://www.cnblogs.com/panlq/p/13266426.html#322225399" class="esa-anchor">#</a></h2>
<p>实现了<code>__enter__</code>和<code>__exit__</code>方法的对象就是一个上文管理器。</p>
<ol>
<li><strong>实现了<code>__enter__</code>和<code>__exit__</code>方法的对象就是一个上文管理器。</strong></li>
</ol>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_4">Copy</div><code class="language-python hljs" id="copy_target_4"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyResource</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__enter__</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'connect ro resource'</span>)
        <span class="hljs-keyword">return</span> self
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__exit__</span>(<span class="hljs-params">self, exc_type, exc_value, tb</span>):</span>
        <span class="hljs-keyword">if</span> tb:
            print(<span class="hljs-string">'process exception'</span>)
        <span class="hljs-keyword">else</span>:
            print(<span class="hljs-string">'no exception'</span>)
        print(<span class="hljs-string">'close resource connection'</span>)
        <span class="hljs-comment"># return True</span>
        <span class="hljs-comment"># return False</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">query</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'query data'</span>)


<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> MyResource() <span class="hljs-keyword">as</span> r:
        <span class="hljs-number">1</span>/<span class="hljs-number">0</span>
        r.query()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    print(e)
</code></pre>
<p><code>with MyResour ce() as r</code> as 的别名r指向的不是上想问管理器对象，而是<code>__enter__</code>方法返回的值，在以上代码确实是返回了对象本身。</p>
<p><code>__exit__</code> 方法 处理退出上下文管理器对象时的一些资源清理工作，并处理异常，三个参数</p>
<ul>
<li>exc_type   异常类型</li>
<li>exc_value  异常原因解释</li>
<li>tb               traceback</li>
</ul>
<p><strong><code>__exit__</code>其实是有返回值的，<code>return True</code>表示，异常信息已经在本方法中处理，外部可不接收异常，<code>return False</code> 表示将异常抛出给上层逻辑处理，默认不写返回，即默认值是<code>None</code>,  <code>None</code>也表示<code>False</code></strong></p>
<ol start="2">
<li><strong>另一种实现上下文管理器的方法是<code>contextmanager</code> 装饰器</strong></li>
</ol>
<p>使用 <code>contextmanager </code>的装饰器，可以简化上下文管理器的实现方式。原理是通过 <code>yield</code> 将函数分割成两部分，<code>yield</code> 之前的语句在<code>__enter__</code> 方法中执行，<code>yield</code> 之后的语句在<code>__exit__</code> 方法中执行。紧跟在 <code>yield</code> 后面的值是函数的返回值。</p>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_5">Copy</div><code class="language-python hljs" id="copy_target_5"><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyResource</span>:</span>
    
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">query</span>(<span class="hljs-params">self</span>):</span>
        print(<span class="hljs-string">'query data'</span>)


<span class="hljs-meta">@contextmanager</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">my_resource</span>():</span>
    print(<span class="hljs-string">'connect ro resource'</span>)
    <span class="hljs-keyword">yield</span> MyResource()
    print(<span class="hljs-string">'close resource connection'</span>)


<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> my_resource() <span class="hljs-keyword">as</span> r:
        r.query()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    print(e)
</code></pre>
<p>两种方法并没有说哪一种方法好，各有优略，看代码环境的使用场景来决定。<code>contextmanager</code></p>
<p>以下就是一个简单的需求，给文字加书名号。</p>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_6">Copy</div><code class="language-python hljs" id="copy_target_6"><span class="hljs-meta">@contextmanager</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">book_mark</span>():</span>
    print(<span class="hljs-string">'《'</span>, end=<span class="hljs-string">''</span>)
    <span class="hljs-keyword">yield</span> 
    print(<span class="hljs-string">'》'</span>, end=<span class="hljs-string">''</span>)


<span class="hljs-keyword">with</span> book_mark():
    print(<span class="hljs-string">'你还年轻? peer已经年少有为!'</span>, end=<span class="hljs-string">''</span>)
</code></pre>
<p><strong>实际应用场景</strong>，封装一些公用方法。</p>
<p>原本业务逻辑中是这样的, 在所有的模型类中，在新建资源的时候都需要<code>add</code>， <code>commit</code>, 或者<code>rollback</code>的操作。</p>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_7">Copy</div><code class="language-python hljs" id="copy_target_7"><span class="hljs-meta">@login_required</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_to_gifts</span>(<span class="hljs-params">isbn</span>):</span>
    <span class="hljs-keyword">if</span> current_user.can_save_to_list(isbn):
        <span class="hljs-keyword">try</span>:
            gift = Gift()
            gift.isbn = isbn
            gift.uid = current_user.<span class="hljs-built_in">id</span>
            db.session.add(gift)
            db.session.commit()
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            db.session.rollback()
            <span class="hljs-keyword">raise</span> e
</code></pre>
<p>简化后</p>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_8">Copy</div><code class="language-python hljs" id="copy_target_8"><span class="hljs-meta">@login_required</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_to_gifts</span>(<span class="hljs-params">isbn</span>):</span>
    <span class="hljs-keyword">if</span> current_user.can_save_to_list(isbn):
        <span class="hljs-keyword">with</span> db.auto_commit():
            gift = Gift()
            gift.isbn = isbn
            gift.uid = current_user.<span class="hljs-built_in">id</span>
            db.session.add(gift)
</code></pre>
<p>其中数据库的封装如下</p>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_9">Copy</div><code class="language-python hljs" id="copy_target_9"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-comment"># __author__ = '__JonPan__'</span>

<span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> contextmanager
<span class="hljs-keyword">from</span> flask_sqlalchemy <span class="hljs-keyword">import</span> SQLAlchemy <span class="hljs-keyword">as</span> _SQLAlchemy, BaseQuery


<span class="hljs-comment"># 抽离公用代码，with 形式来完成db.commit  rollback</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SQLAlchemy</span>(<span class="hljs-params">_SQLAlchemy</span>):</span>

<span class="hljs-meta">    @contextmanager</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">auto_commit</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">yield</span>
            self.session.commit()
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            self.session.rollback()
            <span class="hljs-keyword">raise</span> e


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Query</span>(<span class="hljs-params">BaseQuery</span>):</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">filter_by</span>(<span class="hljs-params">self, **kwargs</span>):</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'status'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> kwargs.keys():
            kwargs[<span class="hljs-string">'status'</span>] = <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>(Query, self).filter_by(**kwargs)


db = SQLAlchemy(query_class=Query)
</code></pre>
<h2 id="420370875">线程隔离机制<a href="https://www.cnblogs.com/panlq/p/13266426.html#420370875" class="esa-anchor">#</a></h2>
<p><a href="./Flask 上下文机制和线程隔离_files/778496-20200708155056775-1634773789.png" data-title="" data-alt="" data-lightbox="roadtrip"><img src="./Flask 上下文机制和线程隔离_files/778496-20200708155056775-1634773789.png" alt="" loading="lazy"></a></p>
<p><strong>如何实现一个Reqeust 指向多个请求实例，且要区分该实例对象所绑定的用户？</strong></p>
<p>字典:</p>
<blockquote>
<p>request = {'key1': val1, 'key2': val2}</p>
</blockquote>
<p>flask引用 <code>werkzeug</code> 中的 <code>local.Local</code> 实现线程隔离</p>
<h3 id="3388219649">Local<a href="https://www.cnblogs.com/panlq/p/13266426.html#3388219649" class="esa-anchor">#</a></h3>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_10">Copy</div><code class="language-python hljs" id="copy_target_10"><span class="hljs-comment"># werkzeug\local.py</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Local</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span>
    __slots__ = (<span class="hljs-string">'__storage__'</span>, <span class="hljs-string">'__ident_func__'</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-built_in">object</span>.__setattr__(self, <span class="hljs-string">'__storage__'</span>, {})
        <span class="hljs-built_in">object</span>.__setattr__(self, <span class="hljs-string">'__ident_func__'</span>, get_ident)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__iter__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">iter</span>(self.__storage__.items())

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__call__</span>(<span class="hljs-params">self, proxy</span>):</span>
        <span class="hljs-string">"""Create a proxy for a name."""</span>
        <span class="hljs-keyword">return</span> LocalProxy(self, proxy)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__release_local__</span>(<span class="hljs-params">self</span>):</span>
        self.__storage__.pop(self.__ident_func__(), <span class="hljs-literal">None</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getattr__</span>(<span class="hljs-params">self, name</span>):</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self.__storage__[self.__ident_func__()][name]
        <span class="hljs-keyword">except</span> KeyError:
            <span class="hljs-keyword">raise</span> AttributeError(name)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__setattr__</span>(<span class="hljs-params">self, name, value</span>):</span>
        <span class="hljs-comment"># 获取当前线程的id</span>
        ident = self.__ident_func__()
        storage = self.__storage__
        <span class="hljs-keyword">try</span>:
            storage[ident][name] = value
        <span class="hljs-keyword">except</span> KeyError:
            storage[ident] = {name: value}

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__delattr__</span>(<span class="hljs-params">self, name</span>):</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">del</span> self.__storage__[self.__ident_func__()][name]
        <span class="hljs-keyword">except</span> KeyError:
            <span class="hljs-keyword">raise</span> AttributeError(name)
</code></pre>
<p>可以看到是使用线程ID来绑定不同的上线文对象。</p>
<h3 id="3606498182">LocalStack<a href="https://www.cnblogs.com/panlq/p/13266426.html#3606498182" class="esa-anchor">#</a></h3>
<pre><div data-tips="复制代码" class="esa-clipboard-button" data-clipboard-target="#copy_target_11">Copy</div><code class="language-python hljs" id="copy_target_11"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocalStack</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span>

    <span class="hljs-string">"""This class works similar to a :class:`Local` but keeps a stack
    of objects instead.  This is best explained with an example::

        &gt;&gt;&gt; ls = LocalStack()
        &gt;&gt;&gt; ls.push(42)
        &gt;&gt;&gt; ls.top
        42
        &gt;&gt;&gt; ls.push(23)
        &gt;&gt;&gt; ls.top
        23
        &gt;&gt;&gt; ls.pop()
        23
        &gt;&gt;&gt; ls.top
        42

    They can be force released by using a :class:`LocalManager` or with
    the :func:`release_local` function but the correct way is to pop the
    item from the stack after using.  When the stack is empty it will
    no longer be bound to the current context (and as such released).

    By calling the stack without arguments it returns a proxy that resolves to
    the topmost item on the stack.

    .. versionadded:: 0.6.1
    """</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span>
        self._local = Local()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__release_local__</span>(<span class="hljs-params">self</span>):</span>
        self._local.__release_local__()

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_get__ident_func__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-keyword">return</span> self._local.__ident_func__

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_set__ident_func__</span>(<span class="hljs-params">self, value</span>):</span>
        <span class="hljs-built_in">object</span>.__setattr__(self._local, <span class="hljs-string">'__ident_func__'</span>, value)
    __ident_func__ = <span class="hljs-built_in">property</span>(_get__ident_func__, _set__ident_func__)
    <span class="hljs-keyword">del</span> _get__ident_func__, _set__ident_func__

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__call__</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_lookup</span>():</span>
            rv = self.top
            <span class="hljs-keyword">if</span> rv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">'object unbound'</span>)
            <span class="hljs-keyword">return</span> rv
        <span class="hljs-keyword">return</span> LocalProxy(_lookup)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">push</span>(<span class="hljs-params">self, obj</span>):</span>
        <span class="hljs-string">"""Pushes a new item to the stack"""</span>
        rv = <span class="hljs-built_in">getattr</span>(self._local, <span class="hljs-string">'stack'</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> rv <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self._local.stack = rv = []
        rv.append(obj)
        <span class="hljs-keyword">return</span> rv

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pop</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-string">"""Removes the topmost item from the stack, will return the
        old value or `None` if the stack was already empty.
        """</span>
        stack = <span class="hljs-built_in">getattr</span>(self._local, <span class="hljs-string">'stack'</span>, <span class="hljs-literal">None</span>)
        <span class="hljs-keyword">if</span> stack <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(stack) == <span class="hljs-number">1</span>:
            release_local(self._local)
            <span class="hljs-keyword">return</span> stack[<span class="hljs-number">-1</span>]
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> stack.pop()

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">top</span>(<span class="hljs-params">self</span>):</span>
        <span class="hljs-string">"""The topmost item on the stack.  If the stack is empty,
        `None` is returned.
        """</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> self._local.stack[<span class="hljs-number">-1</span>]
        <span class="hljs-keyword">except</span> (AttributeError, IndexError):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<blockquote>
<p>Local使用字典的方式实现线程隔离，LocalStack 则封装Local实现了线程隔离的栈结构</p>
</blockquote>
<h2 id="853729864">总结<a href="https://www.cnblogs.com/panlq/p/13266426.html#853729864" class="esa-anchor">#</a></h2>
<ol>
<li>flask上下文的实现使用了设计模式中的代理模式，<code>current_app</code>, <code>requsts</code>, 等代理对象都是线程隔离的, 当我们启动一个线程去执行一个异步操作需要用到应用上下文时(需传入<code>app</code>对象), 如果传入<code>current_app</code>, 此时的<code>app</code> 时<code> unbond</code>的状态, 由于线程id改变了, 所以在新的线程中 所有的栈都是空的, 但是在整个<code>web</code>中 由Flask 实例化的 <code>app</code>是唯一的, 所以获取app传入是可以的  <code>app = current_app._get_current_object()</code></li>
<li>线程隔离的实现机制就是利用线程ID+字典， 使用线程隔离的意义在于：使当前线程能够正确引用到他自己所创建的对象，而不是引用到其他线程所创建的对象</li>
<li><code>current_app  -&gt; (LocalStack.top = AppContext top.app = Flask)</code></li>
<li><code>request  -&gt;  (LocalStack.top = RequestContext.top.request = Request)</code></li>
</ol>
<h2 id="240384644">参考资料<a href="https://www.cnblogs.com/panlq/p/13266426.html#240384644" class="esa-anchor">#</a></h2>
<p><a href="https://coding.imooc.com/class/194.html" target="_blank">Python Flask高级编程-七月</a></p>

</div>
<div id="MySignature" style="display: block;"><div class="esa-post-signature"> 
                        <p>作者：
            JonPan
        </p> 
                        <p>出处：<a href="https://www.cnblogs.com/panlq/p/13266426.html">https://www.cnblogs.com/panlq/p/13266426.html</a></p> 
                        <p>版权：本文采用「<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">署名-非商业性使用-相同方式共享 4.0 国际</a>」知识共享许可协议进行许可。</p> 
                        <p></p> 
                    </div></div>
<div class="clear"></div>
<div id="blog_post_info_block"><div id="BlogPostCategory">
    分类: 
            <a href="https://www.cnblogs.com/panlq/category/1211325.html" target="_blank">Python</a></div>
<div id="EntryTag">
    标签: 
            <a href="https://www.cnblogs.com/panlq/tag/python/">python</a>,             <a href="https://www.cnblogs.com/panlq/tag/flask/">flask</a></div>

    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(13266426,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
        <a id="green_channel_follow" onclick="follow(&#39;fb7898b6-c71b-e511-b908-9dcfd8948a71&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./Flask 上下文机制和线程隔离_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./Flask 上下文机制和线程隔离_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/panlq/" target="_blank"><img src="./Flask 上下文机制和线程隔离_files/20200607172935.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/panlq/">JonPan</a><br>
            <a href="https://home.cnblogs.com/u/panlq/followees/">关注 - 36</a><br>
            <a href="https://home.cnblogs.com/u/panlq/followers/">粉丝 - 10</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;fb7898b6-c71b-e511-b908-9dcfd8948a71&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(13266426,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">1</span>
    </div>
    <div class="buryit" onclick="votePost(13266426,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">1</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script></div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/panlq/p/13265365.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/panlq/p/13265365.html" title="发布于 2020-07-08 10:21">Linux 相关学习内容（不定期更新）</a>
    <br>
    <a href="https://www.cnblogs.com/panlq/p/13334117.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/panlq/p/13334117.html" title="发布于 2020-07-17 23:51">LeetCode-位运算相关题解</a>

</div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2020-07-08 13:35</span>&nbsp;
<a href="https://www.cnblogs.com/panlq/">JonPan</a>&nbsp;
阅读(<span id="post_view_count">929</span>)&nbsp;
评论(<span id="post_comment_count">7</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=13266426" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(13266426);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: &#39;&#39;, targetType: &#39;blogPost&#39;, targetId: &#39;13266426&#39;, targetLink: &#39;https://www.cnblogs.com/panlq/p/13266426.html&#39;, title: &#39;Flask 上下文机制和线程隔离&#39; })">举报</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>
<script src="./Flask 上下文机制和线程隔离_files/highlight.min.js.下载"></script>
<script>markdown_highlight();</script>
<script>
    var allowComments = true, cb_blogId = 416394, cb_blogApp = 'panlq', cb_blogUserGuid = 'fb7898b6-c71b-e511-b908-9dcfd8948a71';
    var cb_entryId = 13266426, cb_entryCreatedDate = '2020-07-08 13:35', cb_postType = 1;
    updatePostStats(
        [cb_entryId],
        function(id, count) { $("#post_view_count").text(count) },
        function(id, count) { $("#post_comment_count").text(count) })
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");
</script>
<a name="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/panlq/p/13266426.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/panlq/p/13266426.html#top">返回顶部</a></div>
    <div id="comment_form_container" style="visibility: visible;"><div class="login_tips">
    登录后才能查看或发表评论，立即 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return account.login(&#39;!comments&#39;);">登录</a> 或者
    <a href="https://www.cnblogs.com/">逛逛</a> 博客园首页
</div>
</div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
    <div id="ad_t2"><a href="https://brands.cnblogs.com/huawei" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-华为专区&#39;)">【推荐】资料合集 | HarmonyOS从入门到大神学习资料下载合集</a><br><a href="http://www.uccpsoft.com/index.htm" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-ucancode&#39;)">【推荐】大型组态、工控、仿真、CAD\GIS 50万行VC++源码免费下载!</a><br><a href="https://www.aliyun.com/activity/daily/bestoffer?userCode=swh7dvlt" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-阿里云-cps&#39;)">【推荐】阿里云爆品销量榜单出炉，精选爆款产品低至0.55折</a><br><a href="http://www.moojnn.com/?source=bokeyuan" target="_blank" onclick="ga(&#39;send&#39;, &#39;event&#39;, &#39;Link&#39;, &#39;click&#39;, &#39;T2-魔镜&#39;)">【推荐】限时秒杀！国云大数据魔镜，企业级云分析平台</a><br></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="under-post-card">
        <div id="div-gpt-ad-1592365906576-0" style="width: 300px; height: 250px;" data-google-query-id="CMeBxLmAh_ECFcibvQodxRUAwQ"><div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C1_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C1_0" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" allow="conversion-measurement &#39;src&#39;" data-google-container-id="1" style="border: 0px; vertical-align: bottom;" data-load-complete="true" src="./Flask 上下文机制和线程隔离_files/saved_resource.html"></iframe></div></div>
    </div>
    <div id="under_post_card1"><div class="under-post-card"><b>园子动态</b>：<br>· <a href="https://www.cnblogs.com/cmt/p/14585828.html" target="_blank">致园友们的一封检讨书：都是我们的错</a><br>· <a href="https://www.cnblogs.com/cmt/p/14595262.html" target="_blank">数据库实例 CPU 100% 引发全站故障</a><br>· <a href="https://www.cnblogs.com/cmt/p/14217355.html" target="_blank">发起一个开源项目：博客引擎 fluss</a><br></div></div>
    <div id="cnblogs_c2" class="under-post-card">
        <div id="div-gpt-ad-1592366332455-0" style="width: 468px; height: 60px;" data-google-query-id="CMiBxLmAh_ECFcibvQodxRUAwQ"><div id="google_ads_iframe_/1090369/C2_0__container__" style="border: 0pt none;"><iframe id="google_ads_iframe_/1090369/C2_0" title="3rd party ad content" name="google_ads_iframe_/1090369/C2_0" width="468" height="60" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" allow="conversion-measurement &#39;src&#39;" data-google-container-id="2" style="border: 0px; vertical-align: bottom;" data-load-complete="true" src="./Flask 上下文机制和线程隔离_files/saved_resource(1).html"></iframe></div></div>
    </div>
    <div id="under_post_card2"><div class="itnews under-post-card">
    <b>最新新闻</b>：
    <br>
 ·          <a href="https://news.cnblogs.com/n/695496/" target="_blank">利路修代言、生椰拿铁断货……慢下来的瑞幸活得还挺好？</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/695500/" target="_blank">26元就能拨5000个骚扰电话？短信、电话骚扰为什么屡禁不止</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/695498/" target="_blank">为什么 iPhone 的原装充电线容易坏？</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/695501/" target="_blank">一片红海的手机市场，难以真我的Realme</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/695514/" target="_blank">苹果新系统很鸿蒙！iPad终于能写代码了，iPhone竟成异地恋神器 | WWDC 2021</a>
        <br>
    » <a href="https://news.cnblogs.com/" title="IT 新闻" target="_blank">更多新闻...</a>
</div></div>
    <div id="HistoryToday" class="under-post-card">
<b>历史上的今天：</b>
<br>

2020-07-08    <a href="https://www.cnblogs.com/panlq/p/13265365.html">Linux 相关学习内容（不定期更新）</a>
    <br>
2018-07-08    <a href="https://www.cnblogs.com/panlq/p/9058247.html">python爬虫练习 -- 签名器+GUI界面（Tkinter）</a>
    <br>
</div>
    <script type="text/javascript">
       var commentManager = new blogCommentManager();
       commentManager.renderComments(0);
       fixPostBody();
       deliverBigBanner();
setTimeout(function() { incrementViewCount(cb_entryId); }, 50);       deliverT2();
       deliverC1C2();
       loadNewsAndKb();
       loadBlogSignature();
LoadPostCategoriesTags(cb_blogId, cb_entryId);       LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
       GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
       loadOptUnderPost();
       GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem"><!--done-->
<h3 class="catListTitle">公告</h3>

<div id="blog-news">
    
<script type="text/javascript">window['__document_write_ajax_callbacks__']['4']();</script><script type="text/javascript">window['__document_write_ajax_callbacks__']['5']();</script><script>window['__document_write_ajax_callbacks__']['1']();</script>
<script type="text/javascript">window['__document_write_ajax_callbacks__']['6']();</script><script type="text/javascript">window['__document_write_ajax_callbacks__']['2']();</script>
    <div id="profile_block">
        昵称：
        <a href="https://home.cnblogs.com/u/panlq/">
            JonPan
        </a>
        <br>
        园龄：
        <a href="https://home.cnblogs.com/u/panlq/" title="入园时间：2015-06-26">
            5年11个月
        </a>
        <br>
        粉丝：
        <a href="https://home.cnblogs.com/u/panlq/followers/">
            10
        </a>
        <br>
        关注：
        <a href="https://home.cnblogs.com/u/panlq/followees/">
            36
        </a>
        <div id="p_b_follow">
<a href="javascript:void(0)" onclick="follow(&#39;fb7898b6-c71b-e511-b908-9dcfd8948a71&#39;)">+加关注</a></div>
        <script type="text/javascript">window['__document_write_ajax_callbacks__']['7']();</script><script>window['__document_write_ajax_callbacks__']['3']();</script>
    </div>
</div>

</div>
<div id="sidebar_c3"></div>
			<div id="blog-calendar" style="">

<table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar" border="0">
    <tbody>
        <tr>
            <td colspan="7">
                <table class="CalTitle" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2021/05/08&#39;); return false;">&lt;</a>
                            </td>
                            <td align="center">2021年6月</td>
                            <td align="right" class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2021/07/08&#39;); return false;">&gt;</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    <tr>
        <th class="CalDayHeader" align="center" abbr="日" scope="col">日</th>
        <th class="CalDayHeader" align="center" abbr="一" scope="col">一</th>
        <th class="CalDayHeader" align="center" abbr="二" scope="col">二</th>
        <th class="CalDayHeader" align="center" abbr="三" scope="col">三</th>
        <th class="CalDayHeader" align="center" abbr="四" scope="col">四</th>
        <th class="CalDayHeader" align="center" abbr="五" scope="col">五</th>
        <th class="CalDayHeader" align="center" abbr="六" scope="col">六</th>
    </tr>
            <tr>
                            <td class="CalOtherMonthDay" align="center">30</td>
                            <td class="CalOtherMonthDay" align="center">31</td>
                        <td class="" align="center">
                            1
                        </td>
                        <td class="" align="center">
                            2
                        </td>
                        <td class="" align="center">
                            3
                        </td>
                        <td class="" align="center">
                            4
                        </td>
                    <td class="CalWeekendDay" align="center">
                        5
                    </td>
            </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            6
                        </td>
                            <td class="" align="center">
                                7
                            </td>
                            <td class="CalTodayDay" align="center">
                                8
                            </td>
                            <td class="" align="center">
                                9
                            </td>
                            <td class="" align="center">
                                10
                            </td>
                            <td class="" align="center">
                                11
                            </td>
                        <td class="CalWeekendDay" align="center">
                            12
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            13
                        </td>
                            <td class="" align="center">
                                14
                            </td>
                            <td class="" align="center">
                                15
                            </td>
                            <td class="" align="center">
                                16
                            </td>
                            <td class="" align="center">
                                17
                            </td>
                            <td class="" align="center">
                                18
                            </td>
                        <td class="CalWeekendDay" align="center">
                            19
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            20
                        </td>
                            <td class="" align="center">
                                21
                            </td>
                            <td class="" align="center">
                                22
                            </td>
                            <td class="" align="center">
                                23
                            </td>
                            <td class="" align="center">
                                24
                            </td>
                            <td class="" align="center">
                                25
                            </td>
                        <td class="CalWeekendDay" align="center">
                            26
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            27
                        </td>
                            <td class="" align="center">
                                28
                            </td>
                            <td class="" align="center">
                                29
                            </td>
                            <td class="" align="center">
                                30
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                1
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                2
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            3
                        </td>
                </tr>
                <tr>
                        <td class="CalOtherMonthDay" align="center">
                            4
                        </td>
                            <td class="CalOtherMonthDay" align="center">
                                5
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                6
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                7
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                8
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                9
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            10
                        </td>
                </tr>
    </tbody>
</table></div><script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    
</div>

<!-- 常用链接 -->


<!-- 最新随笔 -->


<!-- 我的标签 -->
<div id="sidebar_toptags" class="sidebar-block"><div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/python/">python<span class="tag-count">(23)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/js/">js<span class="tag-count">(5)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/Redis/">Redis<span class="tag-count">(4)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/python%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0/">python模块学习<span class="tag-count">(4)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/Bug%E8%AE%B0%E5%BD%95/">Bug记录<span class="tag-count">(4)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/mysql/">mysql<span class="tag-count">(4)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/%E9%9D%A2%E8%AF%95%E9%A2%98/">面试题<span class="tag-count">(3)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/golang/">golang<span class="tag-count">(2)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/Linux/">Linux<span class="tag-count">(2)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/panlq/tag/leetcode/">leetcode<span class="tag-count">(2)</span></a>
        </li>
    <li>
        <a href="https://www.cnblogs.com/panlq/tag/">更多</a>
    </li>

</ul>
</div>

</div>

<!-- 积分与排名 -->


<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">

    <div id="sidebar_postcategory" class="catListPostCategory sidebar-block">
        <h3 class="catListTitle">
            
随笔分类



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/panlq/category/1655874.html" rel="" target="">
    Golang(1)
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/panlq/category/1783417.html" rel="" target="">
    Linux相关内容(3)
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/panlq/category/1211325.html" rel="" target="">
    Python(21)
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/panlq/category/1594314.html" rel="" target="">
    每日得到记录(8)
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/panlq/category/1486847.html" rel="" target="">
    每日一题(3)
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/panlq/category/1211324.html" rel="" target="">
    数据库(5)
</a>
 

                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_记录一些前辈的博客，学习" class="catList记录一些前辈的博客，学习 sidebar-block">
        <h3 class="catListTitle">
            
三人行，必有我师



        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.xilidou.com/" rel="nofollow noopener noreferrer" target="_blank">
    阿里-犀利豆
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://vimiix.com/" rel="nofollow noopener noreferrer" target="">
    vimiix
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://jm.taobao.org/" rel="nofollow noopener noreferrer" target="">
     阿里中间件团队博客
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://draveness.me/golang/docs/part1-prerequisite/ch02-compile/golang-compile-intro/" rel="nofollow noopener noreferrer" target="_blank">
    Go 语言设计与实现
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.kingname.info/" rel="nofollow noopener noreferrer" target="">
    谢乾坤 | Kingname
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="http://draveness.me/" rel="nofollow noopener noreferrer" target="">
    面向信仰编程-优质Go文章
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://tech.meituan.com/" rel="nofollow noopener noreferrer" target="">
    美团技术团队
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://juejin.im/post/5e9da97ff265da47da2ae848#heading-14" rel="nofollow noopener noreferrer" target="">
    微爱CTO-张铁蕾
</a>
 

                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://my.oschina.net/jxcdwangtao" rel="nofollow noopener noreferrer" target="">
    西电王涛
</a>
 

                </li>                
            
        </ul>


    </div>    
</div>

<!-- 最新评论 -->
<div id="sidebar_recentcomments" class="sidebar-block"><div class="catListComment">
<h3 class="catListTitle">最新评论</h3>

	<div class="RecentCommentBlock">
        <ul>
                    <li class="recent_comment_title"><a href="https://www.cnblogs.com/panlq/p/13704965.html">1. Re:WSL2 配置及ubuntu18.04安装mysql8.0+</a></li>
                    <li class="recent_comment_body"><p>你好，我想问一下，既然使用sudo apt install mysql-server，为什么要先配置mysql-apt-config?</p>
</li>
                    <li class="recent_comment_author">--junjiezhou</li>
                    <li class="recent_comment_title"><a href="https://www.cnblogs.com/panlq/p/10642725.html">2. Re:nginx+uwsgi+flask+supervisor 项目部署</a></li>
                    <li class="recent_comment_body"><p>手动点赞</p>
</li>
                    <li class="recent_comment_author">--南风生生</li>
                    <li class="recent_comment_title"><a href="https://www.cnblogs.com/panlq/p/13369842.html">3. Re:Flask前后端分离项目案例</a></li>
                    <li class="recent_comment_body"><p>@拥剑公子<br>
文中有贴项目git<br>
<a href="https://www.cnblogs.com/panlq/p/13266426.html">项目地址git</a></p>
</li>
                    <li class="recent_comment_author">--JonPan</li>
                    <li class="recent_comment_title"><a href="https://www.cnblogs.com/panlq/p/13369842.html">4. Re:Flask前后端分离项目案例</a></li>
                    <li class="recent_comment_body"><p>来个github demo就完美了</p>
</li>
                    <li class="recent_comment_author">--拥剑公子</li>
                    <li class="recent_comment_title"><a href="https://www.cnblogs.com/panlq/p/13266426.html">5. Re:Flask 上下文机制和线程隔离</a></li>
                    <li class="recent_comment_body">@伊贺双刀流 当一个请求过来的时候，在请求上下文被入栈之前，会判断当前的环境是否有AppContext ， 如果没有就获取一个，（current_app是Flask应用的代理对象，是与当前线程或协程隐...</li>
                    <li class="recent_comment_author">--JonPan</li>
        </ul>
    </div>
</div>

</div>


<!-- 阅读排行榜 -->
<div id="sidebar_topviewedposts" class="sidebar-block"><div class="catListView">
<h3 class="catListTitle">阅读排行榜</h3>
	<div id="TopViewPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/9307203.html">
                            1. 斐波那契数列的5种python实现写法(131285)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/8868108.html">
                            2. 解决-Django使用filter过滤时间，无法获取月份的问题(4077)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/13369842.html">
                            3. Flask前后端分离项目案例(1992)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/13704965.html">
                            4. WSL2 配置及ubuntu18.04安装mysql8.0+(1916)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/9058247.html">
                            5. python爬虫练习 -- 签名器+GUI界面（Tkinter）(1731)
                        </a>
                    </li>
        </ul>
    </div>
</div>

</div>

<!-- 评论排行榜 -->
<div id="sidebar_topcommentedposts" class="sidebar-block"><div class="catListFeedback">
<h3 class="catListTitle">评论排行榜</h3>
	<div id="TopFeedbackPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/13266426.html">
                            1. Flask 上下文机制和线程隔离(7)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/9307203.html">
                            2. 斐波那契数列的5种python实现写法(7)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/13369842.html">
                            3. Flask前后端分离项目案例(2)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/10642725.html">
                            4. nginx+uwsgi+flask+supervisor 项目部署(2)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/panlq/p/13704965.html">
                            5. WSL2 配置及ubuntu18.04安装mysql8.0+(1)
                        </a>
                    </li>
        </ul>
    </div>
</div>

</div>

<!-- 推荐排行榜 -->
<div id="sidebar_topdiggedposts" class="sidebar-block">
<div id="topdigg_posts_wrap">
    <div class="catListView">
        <h3 class="catListTitle">推荐排行榜</h3>
        <div id="TopDiggPostsBlock">
            <ul style="word-break: break-all">
                        <li>
                            <a href="https://www.cnblogs.com/panlq/p/13180589.html">
                                1. 深入理解进程，线程，协程(4)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/panlq/p/13430903.html">
                                2. 数据结构中的树(二叉树、二叉搜索树、AVL树)(3)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/panlq/p/9307203.html">
                                3. 斐波那契数列的5种python实现写法(3)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/panlq/p/13704965.html">
                                4. WSL2 配置及ubuntu18.04安装mysql8.0+(1)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/panlq/p/13266426.html">
                                5. Flask 上下文机制和线程隔离(1)
                            </a>
                        </li>
            </ul>
        </div>
    </div>
</div></div></div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright © 2021 JonPan
<br><span id="poweredby">Powered by .NET 5.0 on Kubernetes</span>



	<span class="esa-copyright">&amp; Theme <a href="https://github.com/esofar/cnblogs-theme-silence" target="_blank">Silence v2.0.2</a></span></div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


    

    <input type="hidden" id="antiforgery_token" value="CfDJ8L-rpLgFVEJMgssCVvNUAjuYcyB_zHdIQuqvNQWK1ogDvjZqWF31ZFzcnlb8mfSLj891FL33Qhu-7vdlKHw_bBHXVFtZnGZ2DFE9jP5K80wMN-_DbBNaUzGAfK5hpnY2PbeytO_pVVNJFHggbis_TrY">


<script type="text/javascript">
    $.silence({
        avatar: 'https://images.cnblogs.com/cnblogs_com/panlq/1629174/o_200119155214avatar2.jpg',
        favicon: 'https://images.cnblogs.com/cnblogs_com/panlq/1629174/o_200119145814favicon.png',
        navigation: [
            {
                title: '标签',
                url: 'https://www.cnblogs.com/panlq/tag/'
            },
            {
                title: '归档',
                url: 'https://www.cnblogs.com/panlq/p/'
            },
            {
                title: '每日一题',
                url: 'https://www.cnblogs.com/panlq/category/1486847.html',
            },
            {
                title: '导航',
                chilren: [
                    {
                        title: '好物优选',
                        url: 'http://hwyx.91sq.cc/',
                    }
                ]
            },
        ],
        catalog: {
            enable: true,
            move: true,
            index: true,
            level1: 'h2',
            level2: 'h3',
            level3: 'h4',
        },
        signature: {
            enable: true,
            license: '署名-非商业性使用-相同方式共享 4.0 国际',
            link: 'https://creativecommons.org/licenses/by-nc-sa/4.0/',
            remark: null
        },
        sponsor: {
            enable: false,
            paypal: null,
            wechat: 'https://images.cnblogs.com/cnblogs_com/panlq/1629174/o_200119150653zsm.jpg',
            alipay: 'https://images.cnblogs.com/cnblogs_com/panlq/1629174/o_200119150701zfb2.jpgh'
        },
        github: {
            enable: true,
            link: 'https://github.com/Panlq',
	    target: '_self'
        }
    });
</script><a href="https://github.com/Panlq" class="github-corner" title="Fork me on GitHub" target="_self">
                        <svg width="60" height="60" viewBox="0 0 250 250" style=" color:#fff; z-index: 999; position: fixed; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true">
                            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
                            <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
                            <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
                        </svg>
                    </a><div class="esa-catalog">
                        <div class="esa-catalog-contents" style="display: block;">
                            <div class="esa-catalog-title">CONTENTS</div>
                            <a class="esa-catalog-close">✕</a>
                        <ul><li class="li_h2" title="1. working outside application context">
                            <i class="3113764099"></i><a class="esa-anchor-link"><span class="level1">1. </span>1. working outside application context</a>
                        </li><li class="li_h2" title="2. flask 上下文出入栈">
                            <i class="3459765618"></i><a class="esa-anchor-link"><span class="level1">2. </span>2. flask 上下文出入栈</a>
                        </li><li class="li_h2" title="3. python中的上文管理器">
                            <i class="322225399"></i><a class="esa-anchor-link"><span class="level1">3. </span>3. python中的上文管理器</a>
                        </li><li class="li_h2" title="线程隔离机制">
                            <i class="420370875"></i><a class="esa-anchor-link"><span class="level1">4. </span>线程隔离机制</a>
                        </li><li class="li_h3" title="Local">
                            <i class="3388219649"></i><a class="esa-anchor-link"><span class="level2">4.1. </span>Local</a>
                        </li><li class="li_h3" title="LocalStack">
                            <i class="3606498182"></i><a class="esa-anchor-link"><span class="level2">4.2. </span>LocalStack</a>
                        </li><li class="li_h2" title="总结">
                            <i class="853729864"></i><a class="esa-anchor-link"><span class="level1">5. </span>总结</a>
                        </li><li class="li_h2" title="参考资料">
                            <i class="240384644"></i><a class="esa-anchor-link"><span class="level1">6. </span>参考资料</a>
                        </li></ul></div>
                    </div><div class="esa-toolbar">
                <button class="esa-toolbar-gotop" data-tips="返回顶部" style="display: inline-block;"></button>
                <button class="esa-toolbar-contents" data-tips="阅读目录"></button>
                <button class="esa-toolbar-follow" data-tips="关注博主"></button>
            </div><script type="text/javascript">getFollowStatus('fb7898b6-c71b-e511-b908-9dcfd8948a71');</script><div id="lightboxOverlay" tabindex="-1" class="lightboxOverlay" style="display: none;"></div><div id="lightbox" tabindex="-1" class="lightbox" style="display: none;"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" alt=""><div class="lb-nav"><a class="lb-prev" aria-label="Previous image" href="https://www.cnblogs.com/panlq/p/13266426.html"></a><a class="lb-next" aria-label="Next image" href="https://www.cnblogs.com/panlq/p/13266426.html"></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div><iframe id="google_osd_static_frame_2098926017578" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;" src="./Flask 上下文机制和线程隔离_files/saved_resource(2).html"></iframe><iframe src="./Flask 上下文机制和线程隔离_files/aframe.html" width="0" height="0" style="display: none;"></iframe></body></html>