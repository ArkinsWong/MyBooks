<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>统计学习方法</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
<p id="filepos628435" class="calibre_"><span class="calibre1"><span class="bold">第11章　条件随机场</span></span></p><p class="calibre_13">条件随机场（conditional random field,CRF）是给定一组输入随机变量条件下另一组输出随机变量的条件概率分布模型，其特点是假设输出随机变量构成马尔可夫随机场。条件随机场可以用于不同的预测问题，本书仅论及它在标注问题的应用。因此主要讲述线性链（linear chain）条件随机场，这时，问题变成了由输入序列对输出序列预测的判别模型，形式为对数线性模型，其学习方法通常是极大似然估计或正则化的极大似然估计。线性链条件随机场应用于标注问题是由Lafferty等人于2001年提出的。</p><p class="calibre_8">本章首先介绍概率无向图模型，然后叙述条件随机场的定义和各种表示方法，最后介绍条件随机场的3个基本问题：概率计算问题、学习问题和预测问题。</p><p id="filepos629449" class="calibre_6"><span class="calibre9"><span class="bold">11.1　概率无向图模型</span></span></p><p class="calibre_7">概率无向图模型（probabilistic undirected graphical model），又称为马尔可夫随机场（Markov random field），是一个可以由无向图表示的联合概率分布。本节首先叙述概率无向图模型的定义，然后介绍概率无向图模型的因子分解。</p><p id="filepos629872" class="calibre_6"><span class="calibre2"><span class="bold">11.1.1　模型定义</span></span></p><p class="calibre_7">图（graph）是由结点（node）及连接结点的边（edge）组成的集合。结点和边分别记作v和e，结点和边的集合分别记作V和E，图记作G＝(V,E)。无向图是指边没有方向的图。</p><p class="calibre_8">概率图模型（probabilistic graphical model）是由图表示的概率分布。设有联合概率分布P(Y)，Y∊<img src="images/00940.jpg" class="calibre_29"/>是一组随机变量。由无向图G＝(V,E)表示概率分布P(Y)，即在图G中，结点v∊ V表示一个随机变量Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">v</span></small></sub>，Y＝(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">v</span></small></sub>)<sub class="calibre8"><small class="calibre6"><span class="calibre7">
</span></small></sub>v∊ V；边e∊E表示随机变量之间的概率依赖关系。</p><p class="calibre_8">给定一个联合概率分布P(Y)和表示它的无向图G。首先定义无向图表示的随机变量之间存在的成对马尔可夫性（pairwise Markov property）、局部马尔可夫性（local Markov property）和全局马尔可夫性（global Markov property）。</p><p class="calibre_8">成对马尔可夫性：设u和v是无向图G中任意两个没有边连接的结点，结点u和v分别对应随机变量Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">u</span></small></sub>和Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">v</span></small></sub>。其他所有结点为O，对应的随机变量组是Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">O</span></small></sub>。成对马尔可夫性是指给定随机变量组Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">O</span></small></sub>的条件下随机变量Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">u</span></small></sub>和Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">v</span></small></sub>是条件独立的，即</p><p class="calibre_20"><img src="images/00497.jpg" class="calibre_858"/></p><p class="calibre_24">局部马尔可夫性：设v∊ V是无向图G中任意一个结点，W是与v有边连接的所有结点，O是v，W以外的其他所有结点。v表示的随机变量是Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">v</span></small></sub>，W表示的随机变量组是Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">W</span></small></sub>，O表示的随机变量组是Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">O</span></small></sub>。局部马尔可夫性是指在给定随机变量组Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">W</span></small></sub>的条件下随机变量Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">v</span></small></sub>与随机变量组Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">O</span></small></sub>是独立的，即</p><p class="calibre_20"><img src="images/00026.jpg" class="calibre_859"/></p><p class="calibre_22">在P(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">O</span></small></sub>|Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">W</span></small></sub>)&gt;0时，等价地，</p><p class="calibre_20"><img src="images/00655.jpg" class="calibre_860"/></p><p class="calibre_24">图11.1表示由式（11.2）或式（11.3）所示的局部马尔可夫性。</p><p class="calibre_20"><img src="images/00758.jpg" class="calibre_861"/></p><p class="calibre_20"><span class="calibre4">图11.1　局部马尔可夫性</span></p><p class="calibre_27">全局马尔可夫性：设结点集合A，B是在无向图G中被结点集合C分开的任意结点集合，如图11.2所示。结点集合A，B和C所对应的随机变量组分别是Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">A</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">B</span></small></sub>和Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>。全局马尔可夫性是指给定随机变量组Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>条件下随机变量组Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">A</span></small></sub>和Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">B</span></small></sub>是条件独立的，即</p><p class="calibre_20"><img src="images/00558.jpg" class="calibre_862"/></p><p class="calibre_20"><img src="images/00035.jpg" class="calibre_863"/></p><p class="calibre_20"><span class="calibre4">图11.2　全局马尔可夫性</span></p><p class="calibre_27">上述成对的、局部的、全局的马尔可夫性定义是等价的<sup class="calibre5"><small class="calibre6"><span class="calibre7">[2]</span></small></sup>。</p><p class="calibre_8">下面定义概率无向图模型。</p><p class="calibre_8"><span class="bold">定义11.1（概率无向图模型）</span>　设有联合概率分布P(Y)，由无向图G＝(V,E)表示，在图G中，结点表示随机变量，边表示随机变量之间的依赖关系。如果联合概率分布P(Y)满足成对、局部或全局马尔可夫性，就称此联合概率分布为概率无向图模型（probability undirected graphical model），或马尔可夫随机场（Markov random field）。</p><p class="calibre_8">以上是概率无向图模型的定义，实际上，我们更关心的是如何求其联合概率分布。对给定的概率无向图模型，我们希望将整体的联合概率写成若干子联合概率的乘积的形式，也就是将联合概率进行因子分解，这样便于模型的学习与计算。事实上，概率无向图模型的最大特点就是易于因子分解。下面介绍这一结果。</p><p id="filepos635302" class="calibre_6"><span class="calibre2"><span class="bold">11.1.2　概率无向图模型的因子分解</span></span></p><p class="calibre_7">首先给出无向图中的团与最大团的定义。</p><p class="calibre_8"><span class="bold">定义11.2（团与最大团）</span>　无向图G中任何两个结点均有边连接的结点子集称为团（clique）。若C是无向图G的一个团，并且不能再加进任何一个G的结点使其成为一个更大的团，则称此C为最大团（maximal clique）。</p><p class="calibre_8">图11.3表示由4个结点组成的无向图。图中由2个结点组成的团有5个：{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>}，{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>}，{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>}，{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>}和{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>}。有2个最大团：{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>}和{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>}。而{Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>}不是一个团，因为Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>和Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>没有边连接。</p><p class="calibre_20"><img src="images/00890.jpg" class="calibre_864"/></p><p class="calibre_20"><span class="calibre4">图11.3　无向图的团和最大团</span></p><p class="calibre_27">将概率无向图模型的联合概率分布表示为其最大团上的随机变量的函数的乘积形式的操作，称为概率无向图模型的因子分解（factorization）。</p><p class="calibre_8">给定概率无向图模型，设其无向图为G，C为G上的最大团，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>表示C对应的随机变量。那么概率无向图模型的联合概率分布P(Y)可写作图中所有最大团C上的函数Ψ<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>)的乘积形式，即</p><p class="calibre_20"><img src="images/00123.jpg" class="calibre_865"/></p><p class="calibre_22">其中，Z是规范化因子（normalization factor），由式</p><p class="calibre_20"><img src="images/00233.jpg" class="calibre_866"/></p><p class="calibre_22">给出。规范化因子保证P(Y)构成一个概率分布。函数Ψ<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>)称为势函数（potential function）。这里要求势函数Ψ<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>)是严格正的，通常定义为指数函数：</p><p class="calibre_20"><img src="images/00873.jpg" class="calibre_867"/></p><p class="calibre_24">概率无向图模型的因子分解由下述定理来保证。</p><p class="calibre_8"><span class="bold">定理11.1（Hammersley-Clifford定理）</span>　概率无向图模型的联合概率分布P(Y)可以表示为如下形式：</p><p class="calibre_20"><img src="images/00334.jpg" class="calibre_868"/></p><p class="calibre_22">其中，C是无向图的最大团，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>是C的结点对应的随机变量，Ψ<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">C</span></small></sub>)是C上定义的严格正函数，乘积是在无向图所有的最大团上进行的。</p><p id="filepos639596" class="calibre_6"><span class="calibre9"><span class="bold">11.2　条件随机场的定义与形式</span></span></p><p id="filepos639712" class="calibre_6"><span class="calibre2"><span class="bold">11.2.1　条件随机场的定义</span></span></p><p class="calibre_7">条件随机场（conditional random field）是给定随机变量X条件下，随机变量Y的马尔可夫随机场。这里主要介绍定义在线性链上的特殊的条件随机场，称为线性链条件随机场（linear chain conditional random field）。线性链条件随机场可以用于标注等问题。这时，在条件概率模型P(Y|X)中，Y是输出变量，表示标记序列，X是输入变量，表示需要标注的观测序列。也把标记序列称为状态序列（参见隐马尔可夫模型）。学习时，利用训练数据集通过极大似然估计或正则化的极大似然估计得到条件概率模型<img src="images/00697.jpg" class="calibre_30"/>(Y|X)；预测时，对于给定的输入序列x，求出条件概率<img src="images/00697.jpg" class="calibre_30"/>(Y|X)最大的输出序列<img src="images/00442.jpg" class="calibre_31"/>。</p><p class="calibre_8">首先定义一般的条件随机场，然后定义线性链条件随机场。</p><p class="calibre_8"><span class="bold">定义11.3（条件随机场）</span>　设X与Y是随机变量，P(Y|X)是在给定X的条件下Y的条件概率分布。若随机变量Y构成一个由无向图G＝(V,E)表示的马尔可夫随机场，即</p><p class="calibre_20"><img src="images/00562.jpg" class="calibre_869"/></p><p class="calibre_22">对任意结点v成立，则称条件概率分布P(Y|X)为条件随机场。式中w～v表示在图G＝(V,E)中与结点v有边连接的所有结点w，w≠v表示结点v以外的所有结点，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">v</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">u</span></small></sub>与Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">w</span></small></sub>为结点v，u与w对应的随机变量。</p><p class="calibre_8">在定义中并没有要求X和Y具有相同的结构。现实中，一般假设X和Y有相同的图结构。本书主要考虑无向图为如图11.4与图11.5所示的线性链的情况，即</p><p class="calibre_20"><img src="images/00674.jpg" class="calibre_271"/></p><p class="calibre_22">在此情况下，X＝(X<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,X<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,X<sub class="calibre8"><small class="calibre6"><span class="calibre7">n</span></small></sub>)，Y＝(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">n</span></small></sub>)，最大团是相邻两个结点的集合。线性链条件随机场有下面的定义。</p><p class="calibre_20"><img src="images/00781.jpg" class="calibre_870"/></p><p class="calibre_20"><span class="calibre4">图11.4　线性链条件随机场</span></p><p class="calibre_180"><img src="images/00885.jpg" class="calibre_871"/></p><p class="calibre_20"><span class="calibre4">图11.5　X和Y有相同的图结构的线性链条件随机场</span></p><p class="calibre_27"><span class="bold">定义11.4（线性链条件随机场）</span>　设X＝(X<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,X<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,X<sub class="calibre8"><small class="calibre6"><span class="calibre7">n</span></small></sub>)，Y＝(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">n</span></small></sub>)均为线性链表示的随机变量序列，若在给定随机变量序列X的条件下，随机变量序列Y的条件概率分布P(Y|X)构成条件随机场，即满足马尔可夫性</p><p class="calibre_20"><img src="images/00995.jpg" class="calibre_872"/></p><p class="calibre_22">则称P(Y|X)为线性链条件随机场。在标注问题中，X表示输入观测序列，Y表示对应的输出标记序列或状态序列。</p><p id="filepos643850" class="calibre_6"><span class="calibre2"><span class="bold">11.2.2　条件随机场的参数化形式</span></span></p><p class="calibre_7">根据定理11.1，可以给出线性链条件随机场P(Y|X)的因子分解式，各因子是定义在相邻两个结点上的函数。</p><p class="calibre_8"><span class="bold">定理11.2（线性链条件随机场的参数化形式）</span>　设P(Y|X)为线性链条件随机场，则在随机变量X取值为x的条件下，随机变量Y取值为y的条件概率具有如下形式：</p><p class="calibre_20"><img src="images/00039.jpg" class="calibre_873"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00143.jpg" class="calibre_874"/></p><p class="calibre_22">式中，t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>和s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>是特征函数，<img src="images/00759.jpg" class="calibre_47"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>和<img src="images/01071.jpg" class="calibre_283"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>是对应的权值。Z(x)是规范化因子，求和是在所有可能的输出序列上进行的。</p><p class="calibre_8">式（11.10）和式（11.11）是线性链条件随机场模型的基本形式，表示给定输入序列x，对输出序列y预测的条件概率。式（11.10）和式（11.11）中t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>是定义在边上的特征函数，称为转移特征，依赖于当前和前一个位置，s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>是定义在结点上的特征函数，称为状态特征，依赖于当前位置。t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>和s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>都依赖于位置，是局部特征函数。通常，特征函数t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>和s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>取值为1或0；当满足特征条件时取值为1，否则为0。条件随机场完全由特征函数t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>，s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>和对应的权值<img src="images/00759.jpg" class="calibre_47"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>，<img src="images/01071.jpg" class="calibre_283"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>确定。</p><p class="calibre_8">线性链条件随机场也是对数线性模型（log linear model）。</p><p class="calibre_8">下面看一个简单的例子。</p><p class="calibre_8"><span class="bold">例11.1</span>　设有一标注问题：输入观测序列为X＝(X<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,X<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,X<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>)，输出标记序列为Y＝(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>)，Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>取值于<img src="images/00940.jpg" class="calibre_29"/>＝{1,2}。</p><p class="calibre_8">假设特征t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>,s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>和对应的权值<img src="images/00759.jpg" class="calibre_47"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>,<img src="images/01071.jpg" class="calibre_283"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>如下：</p><p class="calibre_20"><img src="images/00255.jpg" class="calibre_875"/></p><p class="calibre_24">这里只注明特征取值为1的条件，取值为0的条件省略，即</p><p class="calibre_20"><img src="images/00195.jpg" class="calibre_876"/></p><p class="calibre_22">下同。</p><p class="calibre_20"><img src="images/00473.jpg" class="calibre_877"/></p><p class="calibre_22">对给定的观测序列x，求标记序列为y＝(y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,y<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>)＝(1,2,3)的非规范化条件概率（即没有除以规范化因子的条件概率）。</p><p class="calibre_8"><span class="bold">解</span>　由式（11.10），线性链条件随机场模型为</p><p class="calibre_20"><img src="images/00187.jpg" class="calibre_878"/></p><p class="calibre_22">对给定的观测序列x，标记序列y＝(1,2,2)的非规范化条件概率为</p><p class="calibre_20"><img src="images/00780.jpg" class="calibre_879"/></p><p id="filepos648893" class="calibre_6"><span class="calibre2"><span class="bold">11.2.3　条件随机场的简化形式</span></span></p><p class="calibre_7">条件随机场还可以由简化形式表示。注意到条件随机场式（11.10）中同一特征在各个位置都有定义，可以对同一个特征在各个位置求和，将局部特征函数转化为一个全局特征函数，这样就可以将条件随机场写成权值向量和特征向量的内积形式，即条件随机场的简化形式。</p><p class="calibre_8">为简便起见，首先将转移特征和状态特征及其权值用统一的符号表示。设有K<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>个转移特征，K<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>个状态特征，K＝K<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>+K<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>，记</p><p class="calibre_20"><img src="images/00810.jpg" class="calibre_880"/></p><p class="calibre_22">然后，对转移与状态特征在各个位置i求和，记作</p><p class="calibre_20"><img src="images/00369.jpg" class="calibre_881"/></p><p class="calibre_22">用w<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>表示特征f<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>(y,x)的权值，即</p><p class="calibre_20"><img src="images/00457.jpg" class="calibre_882"/></p><p class="calibre_22">于是，条件随机场（11.11）～（11.12）可表示为</p><p class="calibre_20"><img src="images/00067.jpg" class="calibre_883"/></p><p class="calibre_24">若以w表示权值向量，即</p><p class="calibre_20"><img src="images/00173.jpg" class="calibre_884"/></p><p class="calibre_22">以F(y,x)表示全局特征向量，即</p><p class="calibre_20"><img src="images/00280.jpg" class="calibre_885"/></p><p class="calibre_22">则条件随机场可以写成向量w与F(y,x)的内积的形式：</p><p class="calibre_20"><img src="images/00393.jpg" class="calibre_886"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00505.jpg" class="calibre_887"/></p><p id="filepos651333" class="calibre_6"><span class="calibre2"><span class="bold">11.2.4　条件随机场的矩阵形式</span></span></p><p class="calibre_7">条件随机场还可以由矩阵表示。假设P<sub class="calibre8"><small class="calibre6"><span class="calibre7">w</span></small></sub>(Y|X)是由式（11.15）～（11.16）给出的线性链条件随机场，表示对给定观测序列x，相应的标记序列y的条件概率。引进特殊的起点和终点状态标记y<sub class="calibre8"><small class="calibre6"><span class="calibre7">0</span></small></sub>＝start，y<sub class="calibre8"><small class="calibre6"><span class="calibre7">N+1</span></small></sub>＝stop，这时P<sub class="calibre8"><small class="calibre6"><span class="calibre7">w</span></small></sub>(Y|X)可以通过矩阵形式表示。</p><p class="calibre_8">对观测序列x的每一个位置i＝1,2,…,n+1，定义一个m阶矩阵（m是标记y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>取值的个数）</p><p class="calibre_20"><img src="images/00620.jpg" class="calibre_888"/></p><p class="calibre_24">这样，给定观测序列x，标记序列y的非规范化概率可以通过n+1个矩阵的乘积<img src="images/00727.jpg" class="calibre_889"/>表示，于是，条件概率P<sub class="calibre8"><small class="calibre6"><span class="calibre7">w</span></small></sub>(Y|X)是</p><p class="calibre_20"><img src="images/00837.jpg" class="calibre_890"/></p><p class="calibre_22">其中，Z<sub class="calibre8"><small class="calibre6"><span class="calibre7">w</span></small></sub>(x)为规范化因子，是n+1个矩阵的乘积的（start,stop）元素：</p><p class="calibre_20"><img src="images/00946.jpg" class="calibre_562"/></p><p class="calibre_22">注意，y<sub class="calibre8"><small class="calibre6"><span class="calibre7">0</span></small></sub>＝start与y<sub class="calibre8"><small class="calibre6"><span class="calibre7">N+1</span></small></sub>＝stop表示开始状态与终止状态，规范化因子Z<sub class="calibre8"><small class="calibre6"><span class="calibre7">w</span></small></sub>(x)是以start为起点stop为终点通过状态的所有路径y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub> y<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>…y<sub class="calibre8"><small class="calibre6"><span class="calibre7">n</span></small></sub>的非规范化概率<img src="images/00727.jpg" class="calibre_889"/>之和。下面的例子说明了这一事实。</p><p class="calibre_8"><span class="bold">例11.2　</span>给定一个由图11.6所示的线性链条件随机场，观测序列x，状态序列y，i＝1,2,3，n＝3，标记y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>∊{1,2}，假设y<sub class="calibre8"><small class="calibre6"><span class="calibre7">0</span></small></sub>＝start＝1，y<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>＝stop＝1，各个位置的随机矩阵M<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>(x)分别是</p><p class="calibre_20"><img src="images/01056.jpg" class="calibre_891"/></p><p class="calibre_22">试求状态序列y以start为起点stop为终点所有路径的非规范化概率及规范化因子。</p><p class="calibre_8"><span class="bold">解</span>　首先计算图11.6中从start到stop对应于y＝(1,1,1)，y＝(1,1,2)，…，y＝(2,2,2)各路径的非规范化概率分别是</p><p class="calibre_20"><img src="images/00095.jpg" class="calibre_892"/></p><p class="calibre_20"><img src="images/00163.jpg" class="calibre_893"/></p><p class="calibre_20"><span class="calibre4">图11.6　状态路径</span></p><p class="calibre_27">然后按式（11.25）求规范化因子。通过计算矩阵乘积M<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>(x)可知，其第1行第1列的元素为</p><p class="calibre_20"><img src="images/00308.jpg" class="calibre_894"/></p><p class="calibre_22">恰好等于从start到stop的所有路径的非规范化概率之和，即规范化因子Z(x)。</p><p id="filepos655560" class="calibre_6"><span class="calibre9"><span class="bold">11.3　条件随机场的概率计算问题</span></span></p><p class="calibre_7">条件随机场的概率计算问题是给定条件随机场P(Y|X)，输入序列x和输出序列y，计算条件概率P(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>＝y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>|x)，P(Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i-1</span></small></sub>＝y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i-1</span></small></sub>,Y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>＝y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>|x)以及相应的数学期望的问题。为了方便起见，像隐马尔可夫模型那样，引进前向-后向向量，递归地计算以上概率及期望值。这样的算法称为前向-后向算法。</p><p id="filepos656363" class="calibre_6"><span class="calibre2"><span class="bold">11.3.1　前向-后向算法</span></span></p><p class="calibre_7">对每个指标i＝0,1,…,n+1，定义前向向量a<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>(x)：</p><p class="calibre_20"><img src="images/00479.jpg" class="calibre_895"/></p><p class="calibre_22">递推公式为</p><p class="calibre_20"><img src="images/01030.jpg" class="calibre_896"/></p><p class="calibre_22">又可表示为</p><p class="calibre_20"><img src="images/00651.jpg" class="calibre_897"/></p><p class="calibre_22">a<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>(y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>|x)表示在位置i的标记是y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>并且到位置i的前部分标记序列的非规范化概率，y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>可取的值有m个，所以a<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>(x)是m维列向量。</p><p class="calibre_8">同样，对每个指标i＝0,1,…,n+1，定义后向向量β<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>(x)：</p><p class="calibre_20"><img src="images/00753.jpg" class="calibre_898"/></p><p class="calibre_22">又可表示为</p><p class="calibre_20"><img src="images/00861.jpg" class="calibre_899"/></p><p class="calibre_22">β<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>(y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>|x)表示在位置i的标记为y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>并且从i+1到n的后部分标记序列的非规范化概率。</p><p class="calibre_8">由前向-后向向量定义不难得到：</p><p class="calibre_20"><img src="images/00379.jpg" class="calibre_900"/></p><p class="calibre_22">这里，1是元素均为1的m维列向量。</p><p id="filepos658452" class="calibre_6"><span class="calibre2"><span class="bold">11.3.2　概率计算</span></span></p><p class="calibre_7">按照前向-后向向量的定义，很容易计算标记序列在位置i是标记y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>的条件概率和在位置i-1与i是标记y<sub class="calibre8"><small class="calibre6"><span class="calibre7">1-i</span></small></sub>和y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>的条件概率：</p><p class="calibre_20"><img src="images/00384.jpg" class="calibre_901"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00939.jpg" class="calibre_902"/></p><p id="filepos659154" class="calibre_6"><span class="calibre2"><span class="bold">11.3.3　期望值的计算</span></span></p><p class="calibre_7">利用前向-后向向量，可以计算特征函数关于联合分布P(X,Y)和条件分布P(Y|X)的数学期望。</p><p class="calibre_8">特征函数f<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>关于条件分布P(Y|X)的数学期望是</p><p class="calibre_20"><img src="images/00412.jpg" class="calibre_903"/></p><p class="calibre_24">其中，</p><p class="calibre_20"><img src="images/00965.jpg" class="calibre_904"/></p><p class="calibre_24">假设经验分布为<img src="images/00541.jpg" class="calibre_306"/>(X)，特征函数f<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>关于联合分布P(X,Y)的数学期望是</p><p class="calibre_20"><img src="images/00438.jpg" class="calibre_905"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00992.jpg" class="calibre_902"/></p><p class="calibre_24">式（11.34）和式（11.35）是特征函数数学期望的一般计算公式。对于转移特征t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>(y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i-1</span></small></sub>,y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>,x，i)，k＝1,2,…,K<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，可以将式中的f<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>换成t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>；对于状态特征，可以将式中的f<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>换成s<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>，表示为s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>(y<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>，x，i)，k＝K<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>+l，l＝1,2,…,K<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>。</p><p class="calibre_8">有了式（11.32）～式（11.35），对于给定的观测序列x与标记序列y，可以通过一次前向扫描计算a<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>及Z(x)，通过一次后向扫描计算β<sub class="calibre8"><small class="calibre6"><span class="calibre7">i</span></small></sub>，从而计算所有的概率和特征的期望。</p><p id="filepos661546" class="calibre_6"><span class="calibre9"><span class="bold">11.4　条件随机场的学习算法</span></span></p><p class="calibre_7">本节讨论给定训练数据集估计条件随机场模型参数的问题，即条件随机场的学习问题。条件随机场模型实际上是定义在时序数据上的对数线形模型，其学习方法包括极大似然估计和正则化的极大似然估计。具体的优化实现算法有改进的迭代尺度法IIS、梯度下降法以及拟牛顿法（参阅附录A和附录B）。</p><p id="filepos662086" class="calibre_6"><span class="calibre2"><span class="bold">11.4.1　改进的迭代尺度法</span></span></p><p class="calibre_7">已知训练数据集，由此可知经验概率分布<img src="images/00541.jpg" class="calibre_306"/>(X,Y)。可以通过极大化训练数据的对数似然函数来求模型参数。</p><p class="calibre_8">训练数据的对数似然函数为</p><p class="calibre_20"><img src="images/00468.jpg" class="calibre_906"/></p><p class="calibre_22">当P<sub class="calibre8"><small class="calibre6"><span class="calibre7">w</span></small></sub>是一个由式（11.15）和式（11.16）给出的条件随机场模型时，对数似然函数为</p><p class="calibre_20"><img src="images/01020.jpg" class="calibre_907"/></p><p class="calibre_24">改进的迭代尺度法通过迭代的方法不断优化对数似然函数改变量的下界，达到极大化对数似然函数的目的。假设模型的当前参数向量为w＝(w<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,w<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,w<sub class="calibre8"><small class="calibre6"><span class="calibre7">K</span></small></sub>)<sup class="calibre5"><small class="calibre6"><span class="calibre7">T</span></small></sup>，向量的增量为<img src="images/00850.jpg" class="calibre_73"/>＝(<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>)<sup class="calibre5"><small class="calibre6"><span class="calibre7">T</span></small></sup>，更新参数向量为w+<img src="images/00850.jpg" class="calibre_73"/>＝(w<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>+<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,w<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>+<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,w<sub class="calibre8"><small class="calibre6"><span class="calibre7">K</span></small></sub>+<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>)<sup class="calibre5"><small class="calibre6"><span class="calibre7">T</span></small></sup>。在每步迭代过程中，改进的迭代尺度法通过依次求解式（11.36）和式（11.37），得到<img src="images/00850.jpg" class="calibre_73"/>＝(<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>)<sup class="calibre5"><small class="calibre6"><span class="calibre7">T</span></small></sup>。推导可参考本书6.3.1节。</p><p class="calibre_8">关于转移特征t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>的更新方程为</p><p class="calibre_20"><img src="images/00500.jpg" class="calibre_908"/></p><p class="calibre_22">于状态特征ls的更新方程为</p><p class="calibre_20"><img src="images/01051.jpg" class="calibre_909"/></p><p class="calibre_22">这里，T(x,y)是在数据(x,y)中出现所有特征数的总和：</p><p class="calibre_20"><img src="images/00531.jpg" class="calibre_910"/></p><p class="calibre_24"><span class="bold">算法11.1（条件随机场模型学习的改进的迭代尺度法）</span></p><p class="calibre_146">输入：特征函数t<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,t<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,t<sub class="calibre8"><small class="calibre6"><span class="calibre7">K<sub class="calibre12"><small class="calibre13"><span class="calibre13">1</span></small></sub></span></small></sub>，s<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,s<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,s<sub class="calibre8"><small class="calibre6"><span class="calibre7">K<sub class="calibre12"><small class="calibre13"><span class="calibre13">2</span></small></sub></span></small></sub>；经验分布<img src="images/00541.jpg" class="calibre_306"/>(X,Y)；</p><p class="calibre_8">输出：参数估计值<img src="images/00513.jpg" class="calibre_19"/>；模型P<sub class="calibre8"><small class="calibre6"><img src="images/00513.jpg" class="calibre_19"/></small></sub>。</p><p class="calibre_8">（1）对所有k∊{1,2,…,K}，取初值w<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>＝0</p><p class="calibre_8">（2）对每一k∊{1,2,…,K}：</p><p class="calibre_8">（a）当k＝1,2,…,K<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>时，令<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>是方程</p><p class="calibre_20"><img src="images/00152.jpg" class="calibre_911"/></p><p class="calibre_24">的解；</p><p class="calibre_8">当k＝K<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>+l，l＝1,2,…,K<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>时，令<img src="images/00850.jpg" class="calibre_73"/>K<sub class="calibre8"><small class="calibre6"><sub class="calibre12"><small class="calibre13"><span class="calibre13">1</span></small></sub><span class="calibre7">+l</span></small></sub>是方程</p><p class="calibre_20"><img src="images/00563.jpg" class="calibre_912"/></p><p class="calibre_24">的解，式中T(x,y)由式（11.38）给出。</p><p class="calibre_8">（b）更新w<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>值：w<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>←w<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>+<img src="images/00850.jpg" class="calibre_73"/></p><p class="calibre_8">（3）如果不是所有w<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>都收敛，重复步骤(2)。</p><p class="calibre_8">在式（11.36）和式（11.37）中，T(x,y)表示数据(X,Y)中的特征总数，对不同的数据(X,Y)取值可能不同。为了处理这个问题，定义松弛特征</p><p class="calibre_20"><img src="images/00139.jpg" class="calibre_913"/></p><p class="calibre_22">式中S是一个常数。选择足够大的常数S使得对训练数据集的所有数据(X,Y)，s(X,Y)≥0成立。这时特征总数可取S。</p><p class="calibre_8">由式（11.36），对于转移特征t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>，<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>的更新方程是</p><p class="calibre_20"><img src="images/00592.jpg" class="calibre_914"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00065.jpg" class="calibre_915"/></p><p class="calibre_24">同样由式（11.37），对于状态特征s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>，<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>的更新方程是</p><p class="calibre_20"><img src="images/00419.jpg" class="calibre_916"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00096.jpg" class="calibre_917"/></p><p class="calibre_24">以上算法称为算法S。在算法S中需要使常数S取足够大，这样一来，每步迭代的增量向量会变大，算法收敛会变慢。算法T试图解决这个问题。算法T对每个观测序列x计算其特征总数最大值T(x)：</p><p class="calibre_20"><img src="images/00120.jpg" class="calibre_918"/></p><p class="calibre_24">利用前向-后向递推公式，可以很容易地计算T(x)＝t。</p><p class="calibre_8">这时，关于转移特征参数的更新方程可以写成：</p><p class="calibre_20"><img src="images/00570.jpg" class="calibre_919"/></p><p class="calibre_22">这里，a<sub class="calibre8"><small class="calibre6"><span class="calibre7">k,t</span></small></sub>是特征t<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>的期待值，<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>＝logβ<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>。β<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>是多项式方程（11.47）唯一的实根，可以用牛顿法求得。从而求得相关的<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>。</p><p class="calibre_8">同样，关于状态特征的参数更新方程可以写成：</p><p class="calibre_20"><img src="images/00680.jpg" class="calibre_920"/></p><p class="calibre_22">这里，b<sub class="calibre8"><small class="calibre6"><span class="calibre7">l,t</span></small></sub>是特征s<sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>的期望值，<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>＝log<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>，<img src="images/00850.jpg" class="calibre_73"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">l</span></small></sub>是多项式方程（11.48）唯一的实根，也可以用牛顿法求得。</p><p id="filepos671844" class="calibre_6"><span class="calibre2"><span class="bold">11.4.2　拟牛顿法</span></span></p><p class="calibre_7">条件随机场模型学习还可以应用牛顿法或拟牛顿法（参阅附录B）。对于条件随机场模型</p><p class="calibre_20"><img src="images/00147.jpg" class="calibre_921"/></p><p class="calibre_22">学习的优化目标函数是</p><p class="calibre_20"><img src="images/00967.jpg" class="calibre_922"/></p><p class="calibre_22">其梯度函数是</p><p class="calibre_20"><img src="images/00178.jpg" class="calibre_923"/></p><p class="calibre_24">拟牛顿法的BFGS算法如下。</p><p class="calibre_146"><span class="bold">算法11.2（条件随机场模型学习的BFGS算法）</span></p><p class="calibre_146">输入：特征函数f<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>,f<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,f<sub class="calibre8"><small class="calibre6"><span class="calibre7">n</span></small></sub>；经验分布<img src="images/00541.jpg" class="calibre_306"/>(X,Y)；</p><p class="calibre_8">输出：最优参数值<img src="images/00513.jpg" class="calibre_19"/>；最优模型P<sub class="calibre8"><small class="calibre6"><img src="images/00513.jpg" class="calibre_19"/></small></sub>(Y|X)。</p><p class="calibre_8">（1）选定初始点w<sup class="calibre5"><small class="calibre6"><span class="calibre7">(0)</span></small></sup>，取B<sub class="calibre8"><small class="calibre6"><span class="calibre7">0</span></small></sub>为正定对称矩阵，置k＝0</p><p class="calibre_8">（2）计算g<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>＝g(w<sup class="calibre5"><small class="calibre6"><span class="calibre7">(k)</span></small></sup>)。若g<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>＝0，则停止计算；否则转（3）</p><p class="calibre_8">（3）由B<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub> p<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>＝-g<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>求出p<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub></p><p class="calibre_8">（4）一维搜索：求<img src="images/00759.jpg" class="calibre_47"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>使得</p><p class="calibre_20"><img src="images/00650.jpg" class="calibre_924"/></p><p class="calibre_24">（5）置w<sup class="calibre5"><small class="calibre6"><span class="calibre7">(k-1)</span></small></sup>＝w<sup class="calibre5"><small class="calibre6"><span class="calibre7">(k)</span></small></sup>+<img src="images/00759.jpg" class="calibre_47"/><sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>p<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub></p><p class="calibre_8">（6）计算g<sub class="calibre8"><small class="calibre6"><span class="calibre7">k-1</span></small></sub>＝g(w<sup class="calibre5"><small class="calibre6"><span class="calibre7">(k-1)</span></small></sup>)，若g<sub class="calibre8"><small class="calibre6"><span class="calibre7">k</span></small></sub>＝0，则停止计算；否则，按下式求出B<sub class="calibre8"><small class="calibre6"><span class="calibre7">k-1</span></small></sub>：</p><p class="calibre_20"><img src="images/00151.jpg" class="calibre_925"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00261.jpg" class="calibre_694"/></p><p class="calibre_24">（7）置k＝k+1，转（3）。</p><p id="filepos675209" class="calibre_6"><span class="calibre9"><span class="bold">11.5　条件随机场的预测算法</span></span></p><p class="calibre_7">条件随机场的预测问题是给定条件随机场P(Y|X)和输入序列（观测序列）x，求条件概率最大的输出序列（标记序列）y<sup class="calibre5"><small class="calibre6"><span class="calibre7">*</span></small></sup>，即对观测序列进行标注。条件随机场的预测算法是著名的维特比算法（参阅本书10.4节）。</p><p class="calibre_8">由式（11.19）可得：</p><p class="calibre_20"><img src="images/00223.jpg" class="calibre_926"/></p><p class="calibre_22">于是，条件随机场的预测问题成为求非规范化概率最大的最优路径问题</p><p class="calibre_20"><img src="images/00789.jpg" class="calibre_927"/></p><p class="calibre_22">这里，路径表示标记序列。其中，</p><p class="calibre_20"><img src="images/00599.jpg" class="calibre_928"/></p><p class="calibre_22">注意，这时只需计算非规范化概率，而不必计算概率，可以大大提高效率。为了求解最优路径，将式（11.52）写成如下形式：</p><p class="calibre_20"><img src="images/00704.jpg" class="calibre_929"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00817.jpg" class="calibre_930"/></p><p class="calibre_22">是局部特征向量。</p><p class="calibre_8">下面叙述维特比算法。首先求出位置1的各个标记j＝1,2,…,m的非规范化概率：</p><p class="calibre_20"><img src="images/00923.jpg" class="calibre_931"/></p><p class="calibre_22">一般地，由递推公式，求出到位置i的各个标记l＝1,2,…,m的非规范化概率的最大值，同时记录非规范化概率最大值的路径</p><p class="calibre_20"><img src="images/01031.jpg" class="calibre_932"/></p><p class="calibre_20"><img src="images/00074.jpg" class="calibre_933"/></p><p class="calibre_22">直到i＝n时终止。这时求得非规范化概率的最大值为</p><p class="calibre_20"><img src="images/00793.jpg" class="calibre_934"/></p><p class="calibre_22">及最优路径的终点</p><p class="calibre_20"><img src="images/00898.jpg" class="calibre_935"/></p><p class="calibre_22">由此最优路径终点返回，</p><p class="calibre_20"><img src="images/01007.jpg" class="calibre_936"/></p><p class="calibre_22">求得最优路径y<sup class="calibre5"><small class="calibre6"><span class="calibre7">*</span></small></sup>＝(<img src="images/01049.jpg" class="calibre_219"/>,<img src="images/00156.jpg" class="calibre_411"/>,…,<img src="images/00266.jpg" class="calibre_411"/>)<sup class="calibre5"><small class="calibre6"><span class="calibre7">T</span></small></sup>。</p><p class="calibre_8">综上所述，得到条件随机场预测的维特比算法：</p><p class="calibre_146"><span class="bold">算法11.3（条件随机场预测的维特比算法）</span></p><p class="calibre_146">输入：模型特征向量F(y,x)和权值向量w，观测序列x＝(x<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>，x<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>,…,x<sub class="calibre8"><small class="calibre6"><span class="calibre7">n</span></small></sub>)；</p><p class="calibre_8">输出：最优路径y<sup class="calibre5"><small class="calibre6"><span class="calibre7">*</span></small></sup>＝(<img src="images/01049.jpg" class="calibre_219"/>,<img src="images/00156.jpg" class="calibre_411"/>,…,<img src="images/00266.jpg" class="calibre_411"/>)。</p><p class="calibre_8">（1）初始化</p><p class="calibre_20"><img src="images/00251.jpg" class="calibre_624"/></p><p class="calibre_24">（2）递推。对i＝2,3,…,n</p><p class="calibre_20"><img src="images/00483.jpg" class="calibre_937"/></p><p class="calibre_24">（3）终止</p><p class="calibre_20"><img src="images/00278.jpg" class="calibre_938"/></p><p class="calibre_24">（4）返回路径</p><p class="calibre_20"><img src="images/00835.jpg" class="calibre_939"/></p><p class="calibre_24">求得最优路径y<sup class="calibre5"><small class="calibre6"><span class="calibre7">*</span></small></sup>＝(<img src="images/01049.jpg" class="calibre_219"/>,<img src="images/00156.jpg" class="calibre_411"/>,…,<img src="images/00266.jpg" class="calibre_411"/>)。</p><p class="calibre_8">下面通过一个例子说明维特比算法。</p><p class="calibre_8"><span class="bold">例11.3</span>　在例11.1中，用维特比算法求给定的输入序列（观测序列）x对应的最优输出序列（标记序列）y<sup class="calibre5"><small class="calibre6"><span class="calibre7">*</span></small></sup>＝(<img src="images/01049.jpg" class="calibre_219"/>,<img src="images/00156.jpg" class="calibre_411"/>,<img src="images/00821.jpg" class="calibre_940"/>)。</p><p class="calibre_8"><span class="bold">解</span>　特征函数及对应的权值均在例11.1中给出。</p><p class="calibre_8">现在利用维特比算法求最优路径问题：</p><p class="calibre_20"><img src="images/00926.jpg" class="calibre_941"/></p><p class="calibre_24">（1）初始化</p><p class="calibre_20"><img src="images/01034.jpg" class="calibre_942"/></p><p class="calibre_24">（2）递推</p><p class="calibre_20"><img src="images/00078.jpg" class="calibre_943"/></p><p class="calibre_24">（3）终止</p><p class="calibre_20"><img src="images/00367.jpg" class="calibre_944"/></p><p class="calibre_24">（4）返回</p><p class="calibre_20"><img src="images/00291.jpg" class="calibre_945"/></p><p class="calibre_24">最优标记序列</p><p class="calibre_20"><img src="images/00403.jpg" class="calibre_946"/></p><p id="filepos681785" class="calibre_6"><span class="calibre9"><span class="bold">本章概要</span></span></p><p class="calibre_7">1．概率无向图模型是由无向图表示的联合概率分布。无向图上的结点之间的连接关系表示了联合分布的随机变量集合之间的条件独立性，即马尔可夫性。因此，概率无向图模型也称为马尔可夫随机场。</p><p class="calibre_8">概率无向图模型或马尔可夫随机场的联合概率分布可以分解为无向图最大团上的正值函数的乘积的形式。</p><p class="calibre_8">2．条件随机场是给定输入随机变量X条件下，输出随机变量Y的条件概率分布模型，其形式为参数化的对数线性模型。条件随机场的最大特点是假设输出变量之间的联合概率分布构成概率无向图模型，即马尔可夫随机场。条件随机场是判别模型。</p><p class="calibre_8">3．线性链条件随机场是定义在观测序列与标记序列上的条件随机场。线性链条件随机场一般表示为给定观测序列条件下的标记序列的条件概率分布，由参数化的对数线性模型表示。模型包含特征及相应的权值，特征是定义在线性链的边与结点上的。线性链条件随机场的数学表达式是</p><p class="calibre_20"><img src="images/00517.jpg" class="calibre_947"/></p><p class="calibre_22">其中，</p><p class="calibre_20"><img src="images/00632.jpg" class="calibre_948"/></p><p class="calibre_24">4．线性链条件随机场的概率计算通常利用前向-后向算法。</p><p class="calibre_8">5．条件随机场的学习方法通常是极大似然估计方法或正则化的极大似然估计，即在给定训练数据下，通过极大化训练数据的对数似然函数以估计模型参数。具体的算法有改进的迭代尺度算法、梯度下降法、拟牛顿法等。</p><p class="calibre_8">6．线性链条件随机场的一个重要应用是标注。维特比算法是给定观测序列求条件概率最大的标记序列的方法。</p><p id="filepos683978" class="calibre_6"><span class="calibre9"><span class="bold">继续阅读</span></span></p><p class="calibre_7">关于概率无向图模型可以参阅文献[1,2]。关于条件随机场可以参阅文献[3,4]。在条件随机场提出之前已有最大熵马尔可夫模型等模型被提出<sup class="calibre5"><small class="calibre6"><span class="calibre7">[5]</span></small></sup>。条件随机场可以看作是最大熵马尔可夫模型在标注问题上的推广。支持向量机模型也被推广到标注问题上<sup class="calibre5"><small class="calibre6"><span class="calibre7">[6,7]</span></small></sup>。</p><p id="filepos684527" class="calibre_6"><span class="calibre9"><span class="bold">习题</span></span></p><p class="calibre_7">11.1　写出图11.3中无向图描述的概率图模型的因子分解式。</p><p class="calibre_8">11.2　证明Z(x)＝<img src="images/00738.jpg" class="calibre_218"/>(x)·1＝1<sup class="calibre5"><small class="calibre6"><span class="calibre7">T</span></small></sup>·β<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>(x)，其中1是元素均为1的m维列向量。</p><p class="calibre_8">11.3　写出条件随机场模型学习的梯度下降法。</p><p class="calibre_8">11.4　参考图11.6的状态路径图，假设随机矩阵M<sub class="calibre8"><small class="calibre6"><span class="calibre7">1</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">2</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">3</span></small></sub>(x)，M<sub class="calibre8"><small class="calibre6"><span class="calibre7">4</span></small></sub>(x)分别是</p><p class="calibre_20"><img src="images/00845.jpg" class="calibre_949"/></p><p class="calibre_24">求以start＝2为起点stop＝2为终点的所有路径的状态序列y的概率及概率最大的状态序列。</p><p id="filepos685673" class="calibre_6"><span class="calibre9"><span class="bold">参考文献</span></span></p><p class="calibre_7">[1]　Bishop M. Pattern Recognition and Machine Learning. Springer-Verlag,2006</p><p class="calibre_8">[2]　Koller D,Friedman N. Probabilistic Graphical Models: Principles and Techniques. MIT Press,2009</p><p class="calibre_8">[3]　Lafferty J,McCallum A,Pereira F. Conditional random fields: probabilistic models for segmenting and labeling sequence data. In: International Conference on Machine Learning,2001</p><p class="calibre_8">[4]　Sha F,Pereira F. Shallow parsing with conditional random fields. In: Proceedings of the 2003 Conference of the North American Chapter of Association for Computational Linguistics on Human Language Technology,Vol.1,2003</p><p class="calibre_8">[5]　McCallum A,Freitag D,Pereira F. Maximum entropy Markov models for information extraction and segmentation. In: Proc of the International Conference on Machine Learning,2000</p><p class="calibre_8">[6]　Taskar B,Guestrin C,Koller D. Max-margin Markov networks. In: Proc of the NIPS 2003,2003</p><p class="calibre_8">[7]　Tsochantaridis I,Hofmann T,Joachims T. Support vector machine learning for interdependent and structured output spaces. In: ICML,2004</p><div class="mbp_pagebreak" id="calibre_pb_16"></div>
</body></html>
